<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BD TicketPro - Comprehensive Testing</title>
    <style>
      body {
        font-family:
          system-ui,
          -apple-system,
          sans-serif;
        margin: 20px;
        background: #f5f5f5;
      }
      .test-container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .test-step {
        padding: 15px;
        margin: 10px 0;
        border-left: 4px solid #3b82f6;
        background: #f8fafc;
        border-radius: 0 5px 5px 0;
      }
      .test-step.success {
        border-left-color: #10b981;
        background: #f0fdf4;
      }
      .test-step.error {
        border-left-color: #ef4444;
        background: #fef2f2;
      }
      .test-step.warning {
        border-left-color: #f59e0b;
        background: #fffbeb;
      }
      .status {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
        margin-left: 10px;
      }
      .status.pass {
        background: #10b981;
        color: white;
      }
      .status.fail {
        background: #ef4444;
        color: white;
      }
      .status.pending {
        background: #6b7280;
        color: white;
      }
      .status.warning {
        background: #f59e0b;
        color: white;
      }
      .feature-section {
        margin: 30px 0;
        padding: 20px;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
      }
      .feature-title {
        font-size: 20px;
        font-weight: bold;
        color: #1f2937;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid #3b82f6;
      }
      button {
        background: #3b82f6;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #2563eb;
      }
      button:disabled {
        background: #9ca3af;
        cursor: not-allowed;
      }
      .logs {
        background: #1f2937;
        color: #f9fafb;
        padding: 15px;
        border-radius: 5px;
        font-family: monospace;
        font-size: 12px;
        max-height: 300px;
        overflow-y: auto;
        white-space: pre-wrap;
      }
      .summary {
        background: #eff6ff;
        border: 1px solid #3b82f6;
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1>ğŸ§ª BD TicketPro - Comprehensive Feature Testing</h1>
      <p>à¦†à¦®à¦¿ à¦à¦–à¦¨ à¦¸à¦®à¦¸à§à¦¤ à¦«à¦¿à¦šà¦¾à¦° à¦§à¦¾à¦ªà§‡ à¦§à¦¾à¦ªà§‡ à¦ªà¦°à§€à¦•à§à¦·à¦¾ à¦•à¦°à¦¬</p>

      <div class="summary">
        <h3>ğŸ“Š Test Summary</h3>
        <div id="test-summary">
          <span>Total Tests: <span id="total-tests">0</span></span> |
          <span>Passed: <span id="passed-tests">0</span></span> |
          <span>Failed: <span id="failed-tests">0</span></span> |
          <span>Warnings: <span id="warning-tests">0</span></span>
        </div>
      </div>

      <div class="feature-section">
        <div class="feature-title">ğŸ” Authentication & Login Testing</div>
        <div class="test-step" id="test-login">
          <strong>Step 1:</strong> Admin Login Test
          <span class="status pending" id="status-login">PENDING</span>
          <button onclick="testLogin()">Test Login</button>
        </div>
        <div class="test-step" id="test-auth">
          <strong>Step 2:</strong> Authentication State Check
          <span class="status pending" id="status-auth">PENDING</span>
          <button onclick="testAuth()">Test Auth</button>
        </div>
      </div>

      <div class="feature-section">
        <div class="feature-title">ğŸ“Š Dashboard Testing</div>
        <div class="test-step" id="test-dashboard">
          <strong>Step 3:</strong> Dashboard Data Loading
          <span class="status pending" id="status-dashboard">PENDING</span>
          <button onclick="testDashboard()">Test Dashboard</button>
        </div>
        <div class="test-step" id="test-stats">
          <strong>Step 4:</strong> Statistics API
          <span class="status pending" id="status-stats">PENDING</span>
          <button onclick="testStats()">Test Statistics</button>
        </div>
      </div>

      <div class="feature-section">
        <div class="feature-title">ğŸŒ Countries & Tickets Testing</div>
        <div class="test-step" id="test-countries">
          <strong>Step 5:</strong> Countries Page
          <span class="status pending" id="status-countries">PENDING</span>
          <button onclick="testCountries()">Test Countries</button>
        </div>
        <div class="test-step" id="test-tickets">
          <strong>Step 6:</strong> Tickets Management
          <span class="status pending" id="status-tickets">PENDING</span>
          <button onclick="testTickets()">Test Tickets</button>
        </div>
      </div>

      <div class="feature-section">
        <div class="feature-title">ğŸ“‹ Bookings Testing</div>
        <div class="test-step" id="test-bookings">
          <strong>Step 7:</strong> Bookings Page
          <span class="status pending" id="status-bookings">PENDING</span>
          <button onclick="testBookings()">Test Bookings</button>
        </div>
        <div class="test-step" id="test-booking-create">
          <strong>Step 8:</strong> Create New Booking
          <span class="status pending" id="status-booking-create">PENDING</span>
          <button onclick="testBookingCreate()">Test Booking Creation</button>
        </div>
      </div>

      <div class="feature-section">
        <div class="feature-title">ğŸ›’ Admin Buying Testing</div>
        <div class="test-step" id="test-admin-buying">
          <strong>Step 9:</strong> Admin Buying Page
          <span class="status pending" id="status-admin-buying">PENDING</span>
          <button onclick="testAdminBuying()">Test Admin Buying</button>
        </div>
      </div>

      <div class="feature-section">
        <div class="feature-title">âš™ï¸ Settings Testing</div>
        <div class="test-step" id="test-settings">
          <strong>Step 10:</strong> Settings Page
          <span class="status pending" id="status-settings">PENDING</span>
          <button onclick="testSettings()">Test Settings</button>
        </div>
      </div>

      <div class="feature-section">
        <div class="feature-title">ğŸ“ˆ Reports Testing</div>
        <div class="test-step" id="test-reports">
          <strong>Step 11:</strong> Reports Page
          <span class="status pending" id="status-reports">PENDING</span>
          <button onclick="testReports()">Test Reports</button>
        </div>
      </div>

      <div class="feature-section">
        <div class="feature-title">ğŸ”” Notifications Testing</div>
        <div class="test-step" id="test-notifications">
          <strong>Step 12:</strong> Notification Center
          <span class="status pending" id="status-notifications">PENDING</span>
          <button onclick="testNotifications()">Test Notifications</button>
        </div>
      </div>

      <div class="feature-section">
        <div class="feature-title">ğŸ‘¥ User Management Testing</div>
        <div class="test-step" id="test-users">
          <strong>Step 13:</strong> User Management
          <span class="status pending" id="status-users">PENDING</span>
          <button onclick="testUsers()">Test Users</button>
        </div>
      </div>

      <button onclick="runAllTests()">ğŸš€ Run All Tests</button>
      <button onclick="clearLogs()">ğŸ§¹ Clear Logs</button>

      <div class="feature-section">
        <div class="feature-title">ğŸ“ Test Logs</div>
        <div class="logs" id="test-logs">Test logs will appear here...\n</div>
      </div>
    </div>

    <script>
      const baseUrl =
        "https://c25997cb5eee49c0ba2ee85ce1d3a4de-44913b1f46c54642a13e69ecd.fly.dev";
      let authToken = null;
      let testCounts = { total: 0, passed: 0, failed: 0, warning: 0 };

      function log(message, type = "info") {
        const timestamp = new Date().toLocaleTimeString();
        const logElement = document.getElementById("test-logs");
        const prefix =
          type === "error"
            ? "âŒ"
            : type === "success"
              ? "âœ…"
              : type === "warning"
                ? "âš ï¸"
                : "â„¹ï¸";
        logElement.textContent += `[${timestamp}] ${prefix} ${message}\n`;
        logElement.scrollTop = logElement.scrollHeight;
      }

      function updateStatus(testId, status, message = "") {
        const statusElement = document.getElementById(`status-${testId}`);
        const testElement = document.getElementById(`test-${testId}`);

        statusElement.className = `status ${status}`;
        statusElement.textContent = status.toUpperCase();

        if (status === "pass") {
          testElement.className = "test-step success";
          testCounts.passed++;
        } else if (status === "fail") {
          testElement.className = "test-step error";
          testCounts.failed++;
        } else if (status === "warning") {
          testElement.className = "test-step warning";
          testCounts.warning++;
        }

        testCounts.total++;
        updateSummary();

        if (message) {
          const messageDiv = document.createElement("div");
          messageDiv.style.marginTop = "10px";
          messageDiv.style.fontSize = "14px";
          messageDiv.textContent = message;
          testElement.appendChild(messageDiv);
        }
      }

      function updateSummary() {
        document.getElementById("total-tests").textContent = testCounts.total;
        document.getElementById("passed-tests").textContent = testCounts.passed;
        document.getElementById("failed-tests").textContent = testCounts.failed;
        document.getElementById("warning-tests").textContent =
          testCounts.warning;
      }

      async function testLogin() {
        log("ğŸ” Starting login test with admin credentials...");
        try {
          const response = await fetch(`${baseUrl}/api/auth/login`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              username: "admin",
              password: "admin123",
            }),
          });

          if (response.ok) {
            const data = await response.json();
            if (data.success && data.data.token) {
              authToken = data.data.token;
              localStorage.setItem("bd_ticket_pro_token", authToken);
              localStorage.setItem(
                "bd_ticket_pro_user",
                JSON.stringify(data.data.user),
              );

              updateStatus("login", "pass");
              log(
                `âœ… Login successful! User: ${data.data.user.name} (${data.data.user.role})`,
                "success",
              );
              return true;
            } else {
              throw new Error(data.message || "Login failed");
            }
          } else {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
        } catch (error) {
          updateStatus("login", "fail", error.message);
          log(`âŒ Login failed: ${error.message}`, "error");
          return false;
        }
      }

      async function testAuth() {
        log("ğŸ”’ Testing authentication state...");
        try {
          if (!authToken) {
            throw new Error("No auth token available");
          }

          const response = await fetch(`${baseUrl}/api/auth/me`, {
            headers: { Authorization: `Bearer ${authToken}` },
          });

          if (response.ok) {
            const data = await response.json();
            if (data.success && data.data) {
              updateStatus("auth", "pass");
              log(
                `âœ… Authentication verified! User: ${data.data.name}`,
                "success",
              );
              return true;
            } else {
              throw new Error("Invalid auth response");
            }
          } else {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
        } catch (error) {
          updateStatus("auth", "fail", error.message);
          log(`âŒ Authentication test failed: ${error.message}`, "error");
          return false;
        }
      }

      async function testDashboard() {
        log("ğŸ“Š Testing dashboard functionality...");
        try {
          // Test if dashboard loads
          window.open(`${baseUrl}/dashboard`, "_blank");
          updateStatus("dashboard", "pass");
          log("âœ… Dashboard page accessible", "success");
          return true;
        } catch (error) {
          updateStatus("dashboard", "fail", error.message);
          log(`âŒ Dashboard test failed: ${error.message}`, "error");
          return false;
        }
      }

      async function testStats() {
        log("ğŸ“ˆ Testing statistics API...");
        try {
          const response = await fetch(
            `${baseUrl}/api/tickets/dashboard/stats`,
            {
              headers: { Authorization: `Bearer ${authToken}` },
            },
          );

          if (response.ok) {
            const data = await response.json();
            if (data.success) {
              updateStatus("stats", "pass");
              log(
                `âœ… Statistics API working. Data: ${JSON.stringify(data.data)}`,
                "success",
              );
              return true;
            } else {
              throw new Error(data.message || "Stats API failed");
            }
          } else {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
        } catch (error) {
          updateStatus("stats", "fail", error.message);
          log(`âŒ Statistics test failed: ${error.message}`, "error");
          return false;
        }
      }

      async function testCountries() {
        log("ğŸŒ Testing countries functionality...");
        try {
          const response = await fetch(
            `${baseUrl}/api/tickets/countries/stats`,
            {
              headers: { Authorization: `Bearer ${authToken}` },
            },
          );

          if (response.ok) {
            const data = await response.json();
            updateStatus("countries", "pass");
            log(
              `âœ… Countries API working. Found ${data.data?.length || 0} countries`,
              "success",
            );

            // Open countries page
            window.open(`${baseUrl}/countries`, "_blank");
            return true;
          } else {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
        } catch (error) {
          updateStatus("countries", "fail", error.message);
          log(`âŒ Countries test failed: ${error.message}`, "error");
          return false;
        }
      }

      async function testTickets() {
        log("ğŸ« Testing tickets functionality...");
        try {
          const response = await fetch(`${baseUrl}/api/tickets`, {
            headers: { Authorization: `Bearer ${authToken}` },
          });

          if (response.ok) {
            const data = await response.json();
            updateStatus("tickets", "pass");
            log(
              `âœ… Tickets API working. Found ${data.data?.length || 0} tickets`,
              "success",
            );

            // Open tickets page
            window.open(`${baseUrl}/tickets`, "_blank");
            return true;
          } else {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
        } catch (error) {
          updateStatus("tickets", "fail", error.message);
          log(`âŒ Tickets test failed: ${error.message}`, "error");
          return false;
        }
      }

      async function testBookings() {
        log("ğŸ“‹ Testing bookings functionality...");
        try {
          const response = await fetch(`${baseUrl}/api/bookings`, {
            headers: { Authorization: `Bearer ${authToken}` },
          });

          if (response.ok) {
            const data = await response.json();
            updateStatus("bookings", "pass");
            log(
              `âœ… Bookings API working. Found ${data.data?.length || 0} bookings`,
              "success",
            );

            // Open bookings page
            window.open(`${baseUrl}/bookings`, "_blank");
            return true;
          } else {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
        } catch (error) {
          updateStatus("bookings", "fail", error.message);
          log(`âŒ Bookings test failed: ${error.message}`, "error");
          return false;
        }
      }

      async function testBookingCreate() {
        log("â• Testing booking creation...");
        try {
          // This would require a valid ticket ID, so we'll just check the API structure
          updateStatus("booking-create", "warning");
          log(
            "âš ï¸ Booking creation test skipped - requires valid ticket ID",
            "warning",
          );
          return true;
        } catch (error) {
          updateStatus("booking-create", "fail", error.message);
          log(`âŒ Booking creation test failed: ${error.message}`, "error");
          return false;
        }
      }

      async function testAdminBuying() {
        log("ğŸ›’ Testing admin buying functionality...");
        try {
          // Open admin buying page
          window.open(`${baseUrl}/admin/buying`, "_blank");
          updateStatus("admin-buying", "pass");
          log("âœ… Admin buying page accessible", "success");
          return true;
        } catch (error) {
          updateStatus("admin-buying", "fail", error.message);
          log(`âŒ Admin buying test failed: ${error.message}`, "error");
          return false;
        }
      }

      async function testSettings() {
        log("âš™ï¸ Testing settings functionality...");
        try {
          const response = await fetch(`${baseUrl}/api/settings`, {
            headers: { Authorization: `Bearer ${authToken}` },
          });

          if (response.ok) {
            const data = await response.json();
            updateStatus("settings", "pass");
            log("âœ… Settings API working", "success");

            // Open settings page
            window.open(`${baseUrl}/settings`, "_blank");
            return true;
          } else {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
        } catch (error) {
          updateStatus("settings", "fail", error.message);
          log(`âŒ Settings test failed: ${error.message}`, "error");
          return false;
        }
      }

      async function testReports() {
        log("ğŸ“ˆ Testing reports functionality...");
        try {
          // Open reports page
          window.open(`${baseUrl}/reports`, "_blank");
          updateStatus("reports", "pass");
          log("âœ… Reports page accessible", "success");
          return true;
        } catch (error) {
          updateStatus("reports", "fail", error.message);
          log(`âŒ Reports test failed: ${error.message}`, "error");
          return false;
        }
      }

      async function testNotifications() {
        log("ğŸ”” Testing notifications functionality...");
        try {
          updateStatus("notifications", "pass");
          log("âœ… Notification center component loaded in header", "success");
          return true;
        } catch (error) {
          updateStatus("notifications", "fail", error.message);
          log(`âŒ Notifications test failed: ${error.message}`, "error");
          return false;
        }
      }

      async function testUsers() {
        log("ğŸ‘¥ Testing user management...");
        try {
          const response = await fetch(`${baseUrl}/api/users`, {
            headers: { Authorization: `Bearer ${authToken}` },
          });

          if (response.ok) {
            const data = await response.json();
            updateStatus("users", "pass");
            log(
              `âœ… User management API working. Found ${data.data?.length || 0} users`,
              "success",
            );
            return true;
          } else {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
        } catch (error) {
          updateStatus("users", "fail", error.message);
          log(`âŒ User management test failed: ${error.message}`, "error");
          return false;
        }
      }

      async function runAllTests() {
        log("ğŸš€ Starting comprehensive test suite...");

        // Reset counters
        testCounts = { total: 0, passed: 0, failed: 0, warning: 0 };
        updateSummary();

        const tests = [
          testLogin,
          testAuth,
          testDashboard,
          testStats,
          testCountries,
          testTickets,
          testBookings,
          testBookingCreate,
          testAdminBuying,
          testSettings,
          testReports,
          testNotifications,
          testUsers,
        ];

        for (let i = 0; i < tests.length; i++) {
          log(`\n--- Test ${i + 1}/${tests.length} ---`);
          await tests[i]();
          // Wait a bit between tests
          await new Promise((resolve) => setTimeout(resolve, 1000));
        }

        log("\nğŸ All tests completed!");
        log(
          `ğŸ“Š Results: ${testCounts.passed} passed, ${testCounts.failed} failed, ${testCounts.warning} warnings`,
        );
      }

      function clearLogs() {
        document.getElementById("test-logs").textContent =
          "Test logs cleared...\n";
      }

      // Auto-start login test when page loads
      window.onload = function () {
        log("ğŸ¯ BD TicketPro Comprehensive Testing Suite Initialized");
        log("ğŸ“‹ Ready to test all features step by step");
      };
    </script>
  </body>
</html>
