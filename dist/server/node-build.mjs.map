{"version":3,"file":"node-build.mjs","sources":["../../server/database/schema.ts","../../server/database/models.ts","../../server/middleware/auth.ts","../../server/routes/auth.ts","../../server/routes/tickets.ts","../../server/routes/ticket-batches.ts","../../server/routes/bookings.ts","../../server/routes/users.ts","../../server/routes/settings.ts","../../server/index.ts","../../server/node-build.ts"],"sourcesContent":["import Database from \"better-sqlite3\";\nimport { join } from \"path\";\nimport bcrypt from \"bcryptjs\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nconst dbPath = join(process.cwd(), \"bd-ticketpro.db\");\nexport const db = new Database(dbPath);\n\n// Enable foreign keys\ndb.pragma(\"foreign_keys = ON\");\n\n// Create tables\nexport function initializeDatabase() {\n  // Users table\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS users (\n      id TEXT PRIMARY KEY,\n      username TEXT UNIQUE NOT NULL,\n      password_hash TEXT NOT NULL,\n      name TEXT NOT NULL,\n      email TEXT,\n      phone TEXT,\n      role TEXT NOT NULL CHECK (role IN ('admin', 'manager', 'staff')),\n      status TEXT NOT NULL DEFAULT 'active' CHECK (status IN ('active', 'inactive')),\n      last_login TEXT,\n      created_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP,\n      updated_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP\n    )\n  `);\n\n  // Countries table\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS countries (\n      code TEXT PRIMARY KEY,\n      name TEXT NOT NULL,\n      flag TEXT NOT NULL,\n      created_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP\n    )\n  `);\n\n  // Airlines table\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS airlines (\n      id TEXT PRIMARY KEY,\n      name TEXT UNIQUE NOT NULL,\n      code TEXT UNIQUE,\n      created_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP\n    )\n  `);\n\n  // Ticket batches table\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS ticket_batches (\n      id TEXT PRIMARY KEY,\n      country_code TEXT NOT NULL,\n      airline_name TEXT NOT NULL,\n      flight_date TEXT NOT NULL,\n      flight_time TEXT NOT NULL,\n      buying_price INTEGER NOT NULL,\n      quantity INTEGER NOT NULL,\n      agent_name TEXT NOT NULL,\n      agent_contact TEXT,\n      agent_address TEXT,\n      remarks TEXT,\n      document_url TEXT,\n      created_by TEXT NOT NULL,\n      created_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP,\n      FOREIGN KEY (country_code) REFERENCES countries(code),\n      FOREIGN KEY (created_by) REFERENCES users(id)\n    )\n  `);\n\n  // Tickets table\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS tickets (\n      id TEXT PRIMARY KEY,\n      batch_id TEXT NOT NULL,\n      flight_number TEXT NOT NULL,\n      status TEXT NOT NULL DEFAULT 'available' CHECK (status IN ('available', 'booked', 'locked', 'sold')),\n      selling_price INTEGER NOT NULL,\n      aircraft TEXT,\n      terminal TEXT,\n      arrival_time TEXT,\n      duration TEXT,\n      available_seats INTEGER NOT NULL DEFAULT 1,\n      total_seats INTEGER NOT NULL DEFAULT 1,\n      locked_until TEXT,\n      sold_by TEXT,\n      sold_at TEXT,\n      created_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP,\n      updated_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP,\n      FOREIGN KEY (batch_id) REFERENCES ticket_batches(id),\n      FOREIGN KEY (sold_by) REFERENCES users(id)\n    )\n  `);\n\n  // Bookings table\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS bookings (\n      id TEXT PRIMARY KEY,\n      ticket_id TEXT NOT NULL,\n      agent_name TEXT NOT NULL,\n      agent_phone TEXT,\n      agent_email TEXT,\n      passenger_name TEXT NOT NULL,\n      passenger_passport TEXT NOT NULL,\n      passenger_phone TEXT NOT NULL,\n      passenger_email TEXT,\n      pax_count INTEGER NOT NULL DEFAULT 1,\n      selling_price INTEGER NOT NULL,\n      payment_type TEXT NOT NULL CHECK (payment_type IN ('full', 'partial')),\n      partial_amount INTEGER,\n      payment_method TEXT NOT NULL DEFAULT 'cash',\n      payment_details TEXT, -- JSON string for card details, etc.\n      comments TEXT,\n      status TEXT NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'confirmed', 'cancelled', 'expired')),\n      created_by TEXT NOT NULL,\n      confirmed_at TEXT,\n      expires_at TEXT,\n      created_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP,\n      updated_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP,\n      FOREIGN KEY (ticket_id) REFERENCES tickets(id),\n      FOREIGN KEY (created_by) REFERENCES users(id)\n    )\n  `);\n\n  // System settings table\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS system_settings (\n      key TEXT PRIMARY KEY,\n      value TEXT NOT NULL,\n      updated_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP\n    )\n  `);\n\n  // Activity logs table\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS activity_logs (\n      id TEXT PRIMARY KEY,\n      user_id TEXT NOT NULL,\n      action TEXT NOT NULL,\n      entity_type TEXT NOT NULL,\n      entity_id TEXT,\n      details TEXT, -- JSON string\n      ip_address TEXT,\n      user_agent TEXT,\n      created_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP,\n      FOREIGN KEY (user_id) REFERENCES users(id)\n    )\n  `);\n\n  // Create indexes for better performance\n  db.exec(`\n    CREATE INDEX IF NOT EXISTS idx_tickets_batch_id ON tickets(batch_id);\n    CREATE INDEX IF NOT EXISTS idx_tickets_status ON tickets(status);\n    CREATE INDEX IF NOT EXISTS idx_bookings_ticket_id ON bookings(ticket_id);\n    CREATE INDEX IF NOT EXISTS idx_bookings_status ON bookings(status);\n    CREATE INDEX IF NOT EXISTS idx_bookings_created_by ON bookings(created_by);\n    CREATE INDEX IF NOT EXISTS idx_activity_logs_user_id ON activity_logs(user_id);\n    CREATE INDEX IF NOT EXISTS idx_activity_logs_created_at ON activity_logs(created_at);\n  `);\n\n  console.log(\"Database schema initialized successfully\");\n}\n\n// Seed initial data\nexport function seedDatabase() {\n  try {\n    // Check if data already exists\n    const userCount = db\n      .prepare(\"SELECT COUNT(*) as count FROM users\")\n      .get() as { count: number };\n    if (userCount.count > 0) {\n      console.log(\"Database already seeded\");\n      return;\n    }\n\n    // Insert default countries\n    const insertCountry = db.prepare(`\n      INSERT INTO countries (code, name, flag) VALUES (?, ?, ?)\n    `);\n\n    const countries = [\n      [\"KSA\", \"Saudi Arabia\", \"ðŸ‡¸ðŸ‡¦\"],\n      [\"UAE\", \"United Arab Emirates\", \"ðŸ‡¦ðŸ‡ª\"],\n      [\"QAT\", \"Qatar\", \"ðŸ‡¶ðŸ‡¦\"],\n      [\"KWT\", \"Kuwait\", \"ðŸ‡°ðŸ‡¼\"],\n      [\"OMN\", \"Oman\", \"ðŸ‡´ðŸ‡²\"],\n      [\"BHR\", \"Bahrain\", \"ðŸ‡§ðŸ‡­\"],\n      [\"JOR\", \"Jordan\", \"ðŸ‡¯ðŸ‡´\"],\n      [\"LBN\", \"Lebanon\", \"ðŸ‡±ðŸ‡§\"],\n    ];\n\n    for (const country of countries) {\n      insertCountry.run(...country);\n    }\n\n    // Insert default airlines\n    const insertAirline = db.prepare(`\n      INSERT INTO airlines (id, name, code) VALUES (?, ?, ?)\n    `);\n\n    const airlines = [\n      [uuidv4(), \"Air Arabia\", \"G9\"],\n      [uuidv4(), \"Emirates\", \"EK\"],\n      [uuidv4(), \"Qatar Airways\", \"QR\"],\n      [uuidv4(), \"Saudi Airlines\", \"SV\"],\n      [uuidv4(), \"Flydubai\", \"FZ\"],\n      [uuidv4(), \"Kuwait Airways\", \"KU\"],\n      [uuidv4(), \"Oman Air\", \"WY\"],\n      [uuidv4(), \"Gulf Air\", \"GF\"],\n    ];\n\n    for (const airline of airlines) {\n      insertAirline.run(...airline);\n    }\n\n    // Create default users\n    const insertUser = db.prepare(`\n      INSERT INTO users (id, username, password_hash, name, email, phone, role, status)\n      VALUES (?, ?, ?, ?, ?, ?, ?, ?)\n    `);\n\n    const defaultUsers = [\n      {\n        id: uuidv4(),\n        username: \"admin\",\n        password: \"admin123\",\n        name: \"Admin User\",\n        email: \"admin@bdticketpro.com\",\n        phone: \"+8801234567890\",\n        role: \"admin\" as const,\n        status: \"active\" as const,\n      },\n      {\n        id: uuidv4(),\n        username: \"manager\",\n        password: \"manager123\",\n        name: \"Manager User\",\n        email: \"manager@bdticketpro.com\",\n        phone: \"+8801234567891\",\n        role: \"manager\" as const,\n        status: \"active\" as const,\n      },\n      {\n        id: uuidv4(),\n        username: \"staff\",\n        password: \"staff123\",\n        name: \"Staff User\",\n        email: \"staff@bdticketpro.com\",\n        phone: \"+8801234567892\",\n        role: \"staff\" as const,\n        status: \"active\" as const,\n      },\n    ];\n\n    for (const user of defaultUsers) {\n      const passwordHash = bcrypt.hashSync(user.password, 10);\n      insertUser.run(\n        user.id,\n        user.username,\n        passwordHash,\n        user.name,\n        user.email,\n        user.phone,\n        user.role,\n        user.status,\n      );\n    }\n\n    // Insert default system settings\n    const insertSetting = db.prepare(`\n      INSERT INTO system_settings (key, value) VALUES (?, ?)\n    `);\n\n    const settings = [\n      [\"company_name\", \"BD TicketPro\"],\n      [\"company_email\", \"info@bdticketpro.com\"],\n      [\"company_phone\", \"+880-123-456-7890\"],\n      [\"company_address\", \"Dhanmondi, Dhaka, Bangladesh\"],\n      [\"default_currency\", \"BDT\"],\n      [\"timezone\", \"Asia/Dhaka\"],\n      [\"language\", \"en\"],\n      [\"auto_backup\", \"true\"],\n      [\"email_notifications\", \"true\"],\n      [\"sms_notifications\", \"false\"],\n      [\"booking_timeout\", \"24\"],\n    ];\n\n    for (const setting of settings) {\n      insertSetting.run(...setting);\n    }\n\n    // Only seed sample data in development environment\n    if (process.env.NODE_ENV !== \"production\") {\n      // Create sample ticket batches and tickets\n      const adminUser = db\n        .prepare(\"SELECT id FROM users WHERE role = ? LIMIT 1\")\n        .get(\"admin\") as { id: string };\n\n      const insertBatch = db.prepare(`\n        INSERT INTO ticket_batches (id, country_code, airline_name, flight_date, flight_time, buying_price, quantity, agent_name, agent_contact, created_by)\n        VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n      `);\n\n      const insertTicket = db.prepare(`\n        INSERT INTO tickets (id, batch_id, flight_number, selling_price, aircraft, terminal, arrival_time, duration, available_seats, total_seats)\n        VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n      `);\n\n      // Sample data\n      const sampleBatches = [\n        {\n          id: uuidv4(),\n          countryCode: \"KSA\",\n          airline: \"Air Arabia\",\n          flightDate: \"2024-12-25\",\n          flightTime: \"14:30\",\n          buyingPrice: 18000,\n          quantity: 20,\n          agentName: \"Ahmed Travel\",\n          agentContact: \"+8801234567890\",\n        },\n        {\n          id: uuidv4(),\n          countryCode: \"UAE\",\n          airline: \"Emirates\",\n          flightDate: \"2024-12-26\",\n          flightTime: \"09:15\",\n          buyingPrice: 38000,\n          quantity: 15,\n          agentName: \"Gulf Air Agency\",\n          agentContact: \"+8801987654321\",\n        },\n        {\n          id: uuidv4(),\n          countryCode: \"QAT\",\n          airline: \"Qatar Airways\",\n          flightDate: \"2024-12-27\",\n          flightTime: \"20:10\",\n          buyingPrice: 44000,\n          quantity: 10,\n          agentName: \"Royal Travel\",\n          agentContact: \"+8801555666777\",\n        },\n      ];\n\n      for (const batch of sampleBatches) {\n        insertBatch.run(\n          batch.id,\n          batch.countryCode,\n          batch.airline,\n          batch.flightDate,\n          batch.flightTime,\n          batch.buyingPrice,\n          batch.quantity,\n          batch.agentName,\n          batch.agentContact,\n          adminUser.id,\n        );\n\n        // Create individual tickets for this batch\n        for (let i = 1; i <= batch.quantity; i++) {\n          const ticketId = uuidv4();\n          const flightNumber = `${batch.airline === \"Air Arabia\" ? \"G9\" : batch.airline === \"Emirates\" ? \"EK\" : \"QR\"} ${Math.floor(Math.random() * 900) + 100}`;\n          const sellingPrice = Math.floor(batch.buyingPrice * 1.2); // 20% markup\n\n          insertTicket.run(\n            ticketId,\n            batch.id,\n            flightNumber,\n            sellingPrice,\n            batch.airline === \"Air Arabia\"\n              ? \"Airbus A320\"\n              : batch.airline === \"Emirates\"\n                ? \"Boeing 777\"\n                : \"Boeing 787\",\n            `Terminal ${Math.floor(Math.random() * 3) + 1}`,\n            \"18:45\", // Sample arrival time\n            \"4h 15m\", // Sample duration\n            1, // Available seats for this ticket\n            1, // Total seats for this ticket\n          );\n        }\n      }\n\n      // Add sample bookings using correct schema\n      const insertBooking = db.prepare(`\n        INSERT INTO bookings (\n          id, ticket_id, agent_name, agent_phone, agent_email,\n          passenger_name, passenger_passport, passenger_phone, passenger_email, pax_count,\n          selling_price, payment_type, payment_method, status, created_by, created_at, updated_at\n        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n      `);\n\n      // Get first few tickets to create bookings for\n      const sampleTickets = db.prepare(\"SELECT id FROM tickets LIMIT 5\").all() as { id: string }[];\n\n      const sampleBookings = [\n        {\n          id: uuidv4(),\n          ticketId: sampleTickets[0]?.id,\n          agentName: \"Rahman Travel Agency\",\n          agentPhone: \"+8801712345678\",\n          agentEmail: \"rahman@travelagency.com\",\n          passengerName: \"Mohammed Abdul Rahman\",\n          passengerPassport: \"EB1234567\",\n          passengerPhone: \"+8801987654321\",\n          passengerEmail: \"mohammed@email.com\",\n          paxCount: 1,\n          sellingPrice: 22000,\n          paymentType: \"partial\",\n          paymentMethod: \"bank_transfer\",\n          status: \"pending\",\n        },\n        {\n          id: uuidv4(),\n          ticketId: sampleTickets[1]?.id,\n          agentName: \"Dhaka Express Travel\",\n          agentPhone: \"+8801555777888\",\n          agentEmail: \"info@dhakaexpress.com\",\n          passengerName: \"Fatima Begum\",\n          passengerPassport: \"EB2345678\",\n          passengerPhone: \"+8801666888999\",\n          passengerEmail: \"fatima@email.com\",\n          paxCount: 1,\n          sellingPrice: 45600,\n          paymentType: \"full\",\n          paymentMethod: \"cash\",\n          status: \"confirmed\",\n        },\n        {\n          id: uuidv4(),\n          ticketId: sampleTickets[2]?.id,\n          agentName: \"Golden Wings Travel\",\n          agentPhone: \"+8801888999000\",\n          agentEmail: \"contact@goldenwings.com\",\n          passengerName: \"Ahmed Hassan\",\n          passengerPassport: \"EB3456789\",\n          passengerPhone: \"+8801444555666\",\n          passengerEmail: \"ahmed@email.com\",\n          paxCount: 1,\n          sellingPrice: 52800,\n          paymentType: \"full\",\n          paymentMethod: \"bkash\",\n          status: \"pending\",\n        },\n      ];\n\n      for (const booking of sampleBookings) {\n        if (booking.ticketId) {\n          const now = new Date().toISOString();\n          insertBooking.run(\n            booking.id,\n            booking.ticketId,\n            booking.agentName,\n            booking.agentPhone,\n            booking.agentEmail,\n            booking.passengerName,\n            booking.passengerPassport,\n            booking.passengerPhone,\n            booking.passengerEmail,\n            booking.paxCount,\n            booking.sellingPrice,\n            booking.paymentType,\n            booking.paymentMethod,\n            booking.status,\n            adminUser.id,\n            now,\n            now,\n          );\n        }\n      }\n\n      console.log(\"Database seeded successfully with sample data\");\n    } else {\n      console.log(\"Production environment: skipping sample data seeding\");\n    }\n  } catch (error) {\n    console.error(\"Error seeding database:\", error);\n  }\n}\n\n// Helper function to execute database operations\nexport function executeTransaction(operations: () => void) {\n  const transaction = db.transaction(operations);\n  return transaction();\n}\n","import { db } from \"./schema\";\nimport bcrypt from \"bcryptjs\";\nimport { v4 as uuidv4 } from \"uuid\";\n\n// User model\nexport interface User {\n  id: string;\n  username: string;\n  password_hash?: string;\n  name: string;\n  email?: string;\n  phone?: string;\n  role: \"admin\" | \"manager\" | \"staff\";\n  status: \"active\" | \"inactive\";\n  last_login?: string;\n  created_at: string;\n  updated_at: string;\n}\n\nexport class UserRepository {\n  static findById(id: string): User | undefined {\n    return db.prepare(\"SELECT * FROM users WHERE id = ?\").get(id) as User;\n  }\n\n  static findByUsername(username: string): User | undefined {\n    return db\n      .prepare(\"SELECT * FROM users WHERE username = ?\")\n      .get(username) as User;\n  }\n\n  static findAll(): User[] {\n    return db\n      .prepare(\"SELECT * FROM users ORDER BY created_at DESC\")\n      .all() as User[];\n  }\n\n  static create(\n    userData: Omit<User, \"id\" | \"created_at\" | \"updated_at\"> & {\n      password: string;\n    },\n  ): User {\n    const id = uuidv4();\n    const password_hash = bcrypt.hashSync(userData.password, 10);\n    const now = new Date().toISOString();\n\n    const stmt = db.prepare(`\n      INSERT INTO users (id, username, password_hash, name, email, phone, role, status, created_at, updated_at)\n      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    `);\n\n    stmt.run(\n      id,\n      userData.username,\n      password_hash,\n      userData.name,\n      userData.email,\n      userData.phone,\n      userData.role,\n      userData.status,\n      now,\n      now,\n    );\n\n    return this.findById(id)!;\n  }\n\n  static update(id: string, updates: Partial<User>): User | undefined {\n    const now = new Date().toISOString();\n    updates.updated_at = now;\n\n    const fields =\n      Object.keys(updates)\n        .filter((key) => key !== \"id\")\n        .join(\" = ?, \") + \" = ?\";\n    const values = Object.values(updates).filter(\n      (_, index) => Object.keys(updates)[index] !== \"id\",\n    );\n\n    const stmt = db.prepare(`UPDATE users SET ${fields} WHERE id = ?`);\n    stmt.run(...values, id);\n\n    return this.findById(id);\n  }\n\n  static updateLastLogin(id: string): void {\n    const stmt = db.prepare(\"UPDATE users SET last_login = ? WHERE id = ?\");\n    stmt.run(new Date().toISOString(), id);\n  }\n\n  static verifyPassword(password: string, hash: string): boolean {\n    return bcrypt.compareSync(password, hash);\n  }\n\n  static delete(id: string): boolean {\n    const stmt = db.prepare(\"DELETE FROM users WHERE id = ?\");\n    const result = stmt.run(id);\n    return 'changes' in result && result.changes > 0;\n  }\n}\n\n// Country model\nexport interface Country {\n  code: string;\n  name: string;\n  flag: string;\n  created_at: string;\n}\n\nexport class CountryRepository {\n  static findAll(): Country[] {\n    return db\n      .prepare(\"SELECT * FROM countries ORDER BY name\")\n      .all() as Country[];\n  }\n\n  static findByCode(code: string): Country | undefined {\n    return db\n      .prepare(\"SELECT * FROM countries WHERE code = ?\")\n      .get(code) as Country;\n  }\n}\n\n// Airline model\nexport interface Airline {\n  id: string;\n  name: string;\n  code?: string;\n  created_at: string;\n}\n\nexport class AirlineRepository {\n  static findAll(): Airline[] {\n    return db\n      .prepare(\"SELECT * FROM airlines ORDER BY name\")\n      .all() as Airline[];\n  }\n\n  static findById(id: string): Airline | undefined {\n    return db.prepare(\"SELECT * FROM airlines WHERE id = ?\").get(id) as Airline;\n  }\n\n  static findByName(name: string): Airline | undefined {\n    return db\n      .prepare(\"SELECT * FROM airlines WHERE name = ?\")\n      .get(name) as Airline;\n  }\n}\n\n// TicketBatch model\nexport interface TicketBatch {\n  id: string;\n  country_code: string;\n  airline_name: string;\n  flight_date: string;\n  flight_time: string;\n  buying_price: number;\n  quantity: number;\n  agent_name: string;\n  agent_contact?: string;\n  agent_address?: string;\n  remarks?: string;\n  document_url?: string;\n  created_by: string;\n  created_at: string;\n}\n\nexport class TicketBatchRepository {\n  static findAll(): TicketBatch[] {\n    return db\n      .prepare(\"SELECT * FROM ticket_batches ORDER BY created_at DESC\")\n      .all() as TicketBatch[];\n  }\n\n  static findById(id: string): TicketBatch | undefined {\n    return db\n      .prepare(\"SELECT * FROM ticket_batches WHERE id = ?\")\n      .get(id) as TicketBatch;\n  }\n\n  static findByCountry(countryCode: string): TicketBatch[] {\n    return db\n      .prepare(\n        \"SELECT * FROM ticket_batches WHERE country_code = ? ORDER BY created_at DESC\",\n      )\n      .all(countryCode) as TicketBatch[];\n  }\n\n  static create(\n    batchData: Omit<TicketBatch, \"id\" | \"created_at\">,\n  ): TicketBatch {\n    const id = uuidv4();\n    const now = new Date().toISOString();\n\n    const stmt = db.prepare(`\n      INSERT INTO ticket_batches (id, country_code, airline_name, flight_date, flight_time, buying_price, quantity, agent_name, agent_contact, agent_address, remarks, document_url, created_by, created_at)\n      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    `);\n\n    stmt.run(\n      id,\n      batchData.country_code,\n      batchData.airline_name,\n      batchData.flight_date,\n      batchData.flight_time,\n      batchData.buying_price,\n      batchData.quantity,\n      batchData.agent_name,\n      batchData.agent_contact,\n      batchData.agent_address,\n      batchData.remarks,\n      batchData.document_url,\n      batchData.created_by,\n      now,\n    );\n\n    return this.findById(id)!;\n  }\n\n  static getStatsByCountry(): Array<{\n    country_code: string;\n    total_tickets: number;\n    available_tickets: number;\n  }> {\n    return db\n      .prepare(\n        `\n      SELECT \n        tb.country_code,\n        COALESCE(SUM(tb.quantity), 0) as total_tickets,\n        COALESCE(SUM(CASE WHEN t.status = 'available' THEN 1 ELSE 0 END), 0) as available_tickets\n      FROM ticket_batches tb\n      LEFT JOIN tickets t ON tb.id = t.batch_id\n      GROUP BY tb.country_code\n    `,\n      )\n      .all() as Array<{\n      country_code: string;\n      total_tickets: number;\n      available_tickets: number;\n    }>;\n  }\n\n  static delete(id: string): boolean {\n    const stmt = db.prepare(\"DELETE FROM ticket_batches WHERE id = ?\");\n    const result = stmt.run(id);\n    return 'changes' in result && result.changes > 0;\n  }\n}\n\n// Ticket model\nexport interface Ticket {\n  id: string;\n  batch_id: string;\n  flight_number: string;\n  status: \"available\" | \"booked\" | \"locked\" | \"sold\";\n  selling_price: number;\n  aircraft?: string;\n  terminal?: string;\n  arrival_time?: string;\n  duration?: string;\n  available_seats: number;\n  total_seats: number;\n  locked_until?: string;\n  sold_by?: string;\n  sold_at?: string;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface TicketWithBatch extends Ticket {\n  batch: TicketBatch;\n  country: Country;\n}\n\nexport class TicketRepository {\n  static findAll(): TicketWithBatch[] {\n    return db\n      .prepare(\n        `\n      SELECT \n        t.*,\n        tb.country_code, tb.airline_name, tb.flight_date, tb.flight_time, tb.buying_price, tb.agent_name,\n        c.name as country_name, c.flag as country_flag\n      FROM tickets t\n      JOIN ticket_batches tb ON t.batch_id = tb.id\n      JOIN countries c ON tb.country_code = c.code\n      ORDER BY t.created_at DESC\n    `,\n      )\n      .all()\n      .map(this.mapTicketWithBatch) as TicketWithBatch[];\n  }\n\n  static findById(id: string): TicketWithBatch | undefined {\n    const result = db\n      .prepare(\n        `\n      SELECT \n        t.*,\n        tb.country_code, tb.airline_name, tb.flight_date, tb.flight_time, tb.buying_price, tb.agent_name,\n        c.name as country_name, c.flag as country_flag\n      FROM tickets t\n      JOIN ticket_batches tb ON t.batch_id = tb.id\n      JOIN countries c ON tb.country_code = c.code\n      WHERE t.id = ?\n    `,\n      )\n      .get(id);\n\n    return result ? this.mapTicketWithBatch(result) : undefined;\n  }\n\n  static findByCountry(countryCode: string): TicketWithBatch[] {\n    return db\n      .prepare(\n        `\n      SELECT \n        t.*,\n        tb.country_code, tb.airline_name, tb.flight_date, tb.flight_time, tb.buying_price, tb.agent_name,\n        c.name as country_name, c.flag as country_flag\n      FROM tickets t\n      JOIN ticket_batches tb ON t.batch_id = tb.id\n      JOIN countries c ON tb.country_code = c.code\n      WHERE tb.country_code = ?\n      ORDER BY t.created_at DESC\n    `,\n      )\n      .all(countryCode)\n      .map(this.mapTicketWithBatch) as TicketWithBatch[];\n  }\n\n  static create(\n    ticketData: Omit<Ticket, \"id\" | \"created_at\" | \"updated_at\">,\n  ): Ticket {\n    const id = uuidv4();\n    const now = new Date().toISOString();\n\n    const stmt = db.prepare(`\n      INSERT INTO tickets (id, batch_id, flight_number, status, selling_price, aircraft, terminal, arrival_time, duration, available_seats, total_seats, locked_until, sold_by, sold_at, created_at, updated_at)\n      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    `);\n\n    stmt.run(\n      id,\n      ticketData.batch_id,\n      ticketData.flight_number,\n      ticketData.status,\n      ticketData.selling_price,\n      ticketData.aircraft,\n      ticketData.terminal,\n      ticketData.arrival_time,\n      ticketData.duration,\n      ticketData.available_seats,\n      ticketData.total_seats,\n      ticketData.locked_until,\n      ticketData.sold_by,\n      ticketData.sold_at,\n      now,\n      now,\n    );\n\n    return db.prepare(\"SELECT * FROM tickets WHERE id = ?\").get(id) as Ticket;\n  }\n\n  static updateStatus(\n    id: string,\n    status: Ticket[\"status\"],\n    soldBy?: string,\n  ): boolean {\n    const now = new Date().toISOString();\n    let stmt;\n\n    if (status === \"sold\" && soldBy) {\n      stmt = db.prepare(\n        \"UPDATE tickets SET status = ?, sold_by = ?, sold_at = ?, updated_at = ? WHERE id = ?\",\n      );\n      stmt.run(status, soldBy, now, now, id);\n    } else if (status === \"locked\") {\n      const lockedUntil = new Date(\n        Date.now() + 24 * 60 * 60 * 1000,\n      ).toISOString(); // 24 hours from now\n      stmt = db.prepare(\n        \"UPDATE tickets SET status = ?, locked_until = ?, updated_at = ? WHERE id = ?\",\n      );\n      stmt.run(status, lockedUntil, now, id);\n    } else {\n      stmt = db.prepare(\n        \"UPDATE tickets SET status = ?, locked_until = NULL, updated_at = ? WHERE id = ?\",\n      );\n      stmt.run(status, now, id);\n    }\n\n    return (stmt as any).changes > 0;\n  }\n\n  static getDashboardStats() {\n    const today = new Date().toISOString().split(\"T\")[0];\n\n    const todaysSales = db\n      .prepare(\n        `\n      SELECT COUNT(*) as count, COALESCE(SUM(selling_price), 0) as amount\n      FROM tickets \n      WHERE status = 'sold' AND DATE(sold_at) = ?\n    `,\n      )\n      .get(today) as { count: number; amount: number };\n\n    const totalBookings = db\n      .prepare(\n        `\n      SELECT COUNT(*) as count FROM bookings WHERE status = 'confirmed'\n    `,\n      )\n      .get() as { count: number };\n\n    const lockedTickets = db\n      .prepare(\n        `\n      SELECT COUNT(*) as count FROM tickets WHERE status = 'locked'\n    `,\n      )\n      .get() as { count: number };\n\n    const totalInventory = db\n      .prepare(\n        `\n      SELECT COUNT(*) as count FROM tickets WHERE status IN ('available', 'locked')\n    `,\n      )\n      .get() as { count: number };\n\n    const estimatedProfit = db\n      .prepare(\n        `\n      SELECT COALESCE(SUM(t.selling_price - tb.buying_price), 0) as profit\n      FROM tickets t\n      JOIN ticket_batches tb ON t.batch_id = tb.id\n      WHERE t.status = 'sold'\n    `,\n      )\n      .get() as { profit: number };\n\n    return {\n      todaysSales,\n      totalBookings: totalBookings.count,\n      lockedTickets: lockedTickets.count,\n      totalInventory: totalInventory.count,\n      estimatedProfit: estimatedProfit.profit,\n    };\n  }\n\n  private static mapTicketWithBatch(row: any): TicketWithBatch {\n    return {\n      id: row.id,\n      batch_id: row.batch_id,\n      flight_number: row.flight_number,\n      status: row.status,\n      selling_price: row.selling_price,\n      aircraft: row.aircraft,\n      terminal: row.terminal,\n      arrival_time: row.arrival_time,\n      duration: row.duration,\n      available_seats: row.available_seats,\n      total_seats: row.total_seats,\n      locked_until: row.locked_until,\n      sold_by: row.sold_by,\n      sold_at: row.sold_at,\n      created_at: row.created_at,\n      updated_at: row.updated_at,\n      batch: {\n        id: row.batch_id,\n        country_code: row.country_code,\n        airline_name: row.airline_name,\n        flight_date: row.flight_date,\n        flight_time: row.flight_time,\n        buying_price: row.buying_price,\n        quantity: 0, // Will be filled if needed\n        agent_name: row.agent_name,\n        created_by: \"\",\n        created_at: \"\",\n      },\n      country: {\n        code: row.country_code,\n        name: row.country_name,\n        flag: row.country_flag,\n        created_at: \"\",\n      },\n    };\n  }\n}\n\n// Booking model\nexport interface Booking {\n  id: string;\n  ticket_id: string;\n  agent_name: string;\n  agent_phone?: string;\n  agent_email?: string;\n  passenger_name: string;\n  passenger_passport: string;\n  passenger_phone: string;\n  passenger_email?: string;\n  pax_count: number;\n  selling_price: number;\n  payment_type: \"full\" | \"partial\";\n  partial_amount?: number;\n  payment_method: string;\n  payment_details?: string;\n  comments?: string;\n  status: \"pending\" | \"confirmed\" | \"cancelled\" | \"expired\";\n  created_by: string;\n  confirmed_at?: string;\n  expires_at?: string;\n  created_at: string;\n  updated_at: string;\n}\n\nexport class BookingRepository {\n  static findAll(): Booking[] {\n    return db\n      .prepare(\"SELECT * FROM bookings ORDER BY created_at DESC\")\n      .all() as Booking[];\n  }\n\n  // Transform booking data for frontend compatibility\n  static transformForFrontend(booking: Booking) {\n    return {\n      ...booking,\n      agentInfo: {\n        name: booking.agent_name,\n        phone: booking.agent_phone,\n        email: booking.agent_email,\n      },\n      passengerInfo: {\n        name: booking.passenger_name,\n        passportNo: booking.passenger_passport,\n        phone: booking.passenger_phone,\n        email: booking.passenger_email,\n        paxCount: booking.pax_count,\n      },\n    };\n  }\n\n  static findAllForFrontend() {\n    const bookings = this.findAll();\n    return bookings.map(booking => this.transformForFrontend(booking));\n  }\n\n  static findById(id: string): Booking | undefined {\n    return db.prepare(\"SELECT * FROM bookings WHERE id = ?\").get(id) as Booking;\n  }\n\n  static findByUser(userId: string): Booking[] {\n    return db\n      .prepare(\n        \"SELECT * FROM bookings WHERE created_by = ? ORDER BY created_at DESC\",\n      )\n      .all(userId) as Booking[];\n  }\n\n  static create(\n    bookingData: Omit<Booking, \"id\" | \"created_at\" | \"updated_at\">,\n  ): Booking {\n    const id = uuidv4();\n    const now = new Date().toISOString();\n    const expiresAt =\n      bookingData.payment_type === \"partial\"\n        ? new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString() // 24 hours\n        : undefined;\n\n    const stmt = db.prepare(`\n      INSERT INTO bookings (id, ticket_id, agent_name, agent_phone, agent_email, passenger_name, passenger_passport, passenger_phone, passenger_email, pax_count, selling_price, payment_type, partial_amount, payment_method, payment_details, comments, status, created_by, expires_at, created_at, updated_at)\n      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    `);\n\n    stmt.run(\n      id,\n      bookingData.ticket_id,\n      bookingData.agent_name,\n      bookingData.agent_phone,\n      bookingData.agent_email,\n      bookingData.passenger_name,\n      bookingData.passenger_passport,\n      bookingData.passenger_phone,\n      bookingData.passenger_email,\n      bookingData.pax_count,\n      bookingData.selling_price,\n      bookingData.payment_type,\n      bookingData.partial_amount,\n      bookingData.payment_method,\n      bookingData.payment_details,\n      bookingData.comments,\n      bookingData.status,\n      bookingData.created_by,\n      expiresAt,\n      now,\n      now,\n    );\n\n    return this.findById(id)!;\n  }\n\n  static updateStatus(id: string, status: Booking[\"status\"]): boolean {\n    const now = new Date().toISOString();\n    let stmt;\n\n    if (status === \"confirmed\") {\n      stmt = db.prepare(\n        \"UPDATE bookings SET status = ?, confirmed_at = ?, updated_at = ? WHERE id = ?\",\n      );\n      stmt.run(status, now, now, id);\n    } else {\n      stmt = db.prepare(\n        \"UPDATE bookings SET status = ?, updated_at = ? WHERE id = ?\",\n      );\n      stmt.run(status, now, id);\n    }\n\n    return (stmt as any).changes > 0;\n  }\n}\n\n// System Settings model\nexport interface SystemSetting {\n  key: string;\n  value: string;\n  updated_at: string;\n}\n\nexport class SystemSettingsRepository {\n  static findAll(): Record<string, string> {\n    const settings = db\n      .prepare(\"SELECT key, value FROM system_settings\")\n      .all() as SystemSetting[];\n    return settings.reduce(\n      (acc, setting) => {\n        acc[setting.key] = setting.value;\n        return acc;\n      },\n      {} as Record<string, string>,\n    );\n  }\n\n  static get(key: string): string | undefined {\n    const result = db\n      .prepare(\"SELECT value FROM system_settings WHERE key = ?\")\n      .get(key) as { value: string } | undefined;\n    return result?.value;\n  }\n\n  static set(key: string, value: string): void {\n    const now = new Date().toISOString();\n    const stmt = db.prepare(`\n      INSERT INTO system_settings (key, value, updated_at) \n      VALUES (?, ?, ?)\n      ON CONFLICT(key) DO UPDATE SET value = ?, updated_at = ?\n    `);\n    stmt.run(key, value, now, value, now);\n  }\n\n  static setBatch(settings: Record<string, string>): void {\n    const now = new Date().toISOString();\n    const stmt = db.prepare(`\n      INSERT INTO system_settings (key, value, updated_at) \n      VALUES (?, ?, ?)\n      ON CONFLICT(key) DO UPDATE SET value = ?, updated_at = ?\n    `);\n\n    const transaction = db.transaction(() => {\n      for (const [key, value] of Object.entries(settings)) {\n        stmt.run(key, value, now, value, now);\n      }\n    });\n\n    transaction();\n  }\n}\n\n// Activity Log model\nexport interface ActivityLog {\n  id: string;\n  user_id: string;\n  action: string;\n  entity_type: string;\n  entity_id?: string;\n  details?: string;\n  ip_address?: string;\n  user_agent?: string;\n  created_at: string;\n}\n\nexport class ActivityLogRepository {\n  static create(logData: Omit<ActivityLog, \"id\" | \"created_at\">): ActivityLog {\n    const id = uuidv4();\n    const now = new Date().toISOString();\n\n    const stmt = db.prepare(`\n      INSERT INTO activity_logs (id, user_id, action, entity_type, entity_id, details, ip_address, user_agent, created_at)\n      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)\n    `);\n\n    stmt.run(\n      id,\n      logData.user_id,\n      logData.action,\n      logData.entity_type,\n      logData.entity_id,\n      logData.details,\n      logData.ip_address,\n      logData.user_agent,\n      now,\n    );\n\n    return db\n      .prepare(\"SELECT * FROM activity_logs WHERE id = ?\")\n      .get(id) as ActivityLog;\n  }\n\n  static findByUser(userId: string, limit: number = 50): ActivityLog[] {\n    return db\n      .prepare(\n        \"SELECT * FROM activity_logs WHERE user_id = ? ORDER BY created_at DESC LIMIT ?\",\n      )\n      .all(userId, limit) as ActivityLog[];\n  }\n\n  static findRecent(limit: number = 100): ActivityLog[] {\n    return db\n      .prepare(\"SELECT * FROM activity_logs ORDER BY created_at DESC LIMIT ?\")\n      .all(limit) as ActivityLog[];\n  }\n}\n","import { Request, Response, NextFunction } from \"express\";\nimport jwt from \"jsonwebtoken\";\nimport { UserRepository } from \"../database/models\";\n\n// JWT configuration\nconst JWT_SECRET = process.env.JWT_SECRET || \"fallback_secret_key\";\nconst JWT_EXPIRES_IN = process.env.JWT_EXPIRES_IN || \"7d\";\n\nexport interface JWTPayload {\n  userId: string;\n  username: string;\n  role: string;\n}\n\n// Generate JWT token\nexport function generateToken(user: { id: string; username: string; role: string }): string {\n  const payload: JWTPayload = {\n    userId: user.id,\n    username: user.username,\n    role: user.role,\n  };\n\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: JWT_EXPIRES_IN as jwt.SignOptions[\"expiresIn\"] });\n}\n\nexport function verifyToken(token: string): JWTPayload | null {\n  try {\n    return jwt.verify(token, JWT_SECRET) as JWTPayload;\n  } catch (error) {\n    return null;\n  }\n}\n\n// Authentication middleware\nexport function authenticate(req: Request, res: Response, next: NextFunction) {\n  const authHeader = req.headers.authorization;\n  const token =\n    authHeader && authHeader.startsWith(\"Bearer \")\n      ? authHeader.substring(7)\n      : null;\n\n  if (!token) {\n    return res.status(401).json({\n      success: false,\n      message: \"Access token required\",\n    });\n  }\n\n  const payload = verifyToken(token);\n  if (!payload) {\n    return res.status(401).json({\n      success: false,\n      message: \"Invalid or expired token\",\n    });\n  }\n\n  // Get user from database\n  const user = UserRepository.findById(payload.userId);\n  if (!user || user.status !== \"active\") {\n    return res.status(401).json({\n      success: false,\n      message: \"User not found or inactive\",\n    });\n  }\n\n  // Remove password hash from user object\n  delete (user as { password_hash?: string }).password_hash;\n  req.user = user;\n  next();\n}\n\n// Role-based authorization middleware\nexport function authorize(roles: string | string[]) {\n  return (req: Request, res: Response, next: NextFunction) => {\n    if (!req.user) {\n      return res.status(401).json({\n        success: false,\n        message: \"Authentication required\",\n      });\n    }\n\n    const allowedRoles = Array.isArray(roles) ? roles : [roles];\n    if (!allowedRoles.includes(req.user.role)) {\n      return res.status(403).json({\n        success: false,\n        message: \"Insufficient permissions\",\n      });\n    }\n\n    next();\n  };\n}\n\n// Permission-based authorization\nexport const PERMISSIONS = {\n  admin: [\n    \"view_buying_price\",\n    \"edit_batches\",\n    \"delete_batches\",\n    \"create_batches\",\n    \"view_profit\",\n    \"override_locks\",\n    \"manage_users\",\n    \"view_all_bookings\",\n    \"confirm_bookings\",\n    \"confirm_sales\",\n    \"system_settings\",\n  ],\n  manager: [\n    \"view_tickets\",\n    \"create_bookings\",\n    \"confirm_bookings\",\n    \"confirm_sales\",\n    \"view_all_bookings\",\n  ],\n  staff: [\"view_tickets\", \"create_bookings\", \"partial_payments\"],\n};\n\nexport function hasPermission(role: string, permission: string): boolean {\n  return (\n    PERMISSIONS[role as keyof typeof PERMISSIONS]?.includes(permission) || false\n  );\n}\n\nexport function requirePermission(permission: string) {\n  return (req: Request, res: Response, next: NextFunction) => {\n    if (!req.user) {\n      return res.status(401).json({\n        success: false,\n        message: \"Authentication required\",\n      });\n    }\n\n    if (!hasPermission(req.user.role, permission)) {\n      return res.status(403).json({\n        success: false,\n        message: `Permission '${permission}' required`,\n      });\n    }\n\n    next();\n  };\n}\n\n// Activity logging middleware\nexport function logActivity(action: string, entityType: string) {\n  return (req: Request, res: Response, next: NextFunction) => {\n    // Store activity info to be logged after request completion\n    res.locals.activityLog = {\n      action,\n      entityType,\n      userId: req.user?.id,\n      ipAddress: req.ip || req.connection.remoteAddress,\n      userAgent: req.get(\"User-Agent\"),\n    };\n    next();\n  };\n}","import { Router, Request, Response } from \"express\";\nimport { UserRepository, ActivityLogRepository } from \"../database/models\";\nimport { generateToken, authenticate } from \"../middleware/auth\";\nimport { z } from \"zod\";\n\nconst router = Router();\n\n// Login schema validation\nconst loginSchema = z.object({\n  username: z.string().min(1, \"Username is required\"),\n  password: z.string().min(1, \"Password is required\"),\n});\n\n// Login endpoint\nrouter.post(\"/login\", async (req: Request, res: Response) => {\n  try {\n    const { username, password } = loginSchema.parse(req.body);\n\n    // Find user by username\n    const user = UserRepository.findByUsername(username);\n    if (!user) {\n      return res.status(401).json({\n        success: false,\n        message: \"Invalid username or password\",\n      });\n    }\n\n    // Check if user is active\n    if (user.status !== \"active\") {\n      return res.status(401).json({\n        success: false,\n        message: \"Account is inactive\",\n      });\n    }\n\n    // Verify password\n    if (!UserRepository.verifyPassword(password, user.password_hash!)) {\n      return res.status(401).json({\n        success: false,\n        message: \"Invalid username or password\",\n      });\n    }\n\n    // Update last login\n    UserRepository.updateLastLogin(user.id);\n\n    // Log activity\n    ActivityLogRepository.create({\n      user_id: user.id,\n      action: \"login\",\n      entity_type: \"auth\",\n      ip_address: req.ip || req.connection.remoteAddress,\n      user_agent: req.get(\"User-Agent\"),\n    });\n\n    // Generate JWT token\n    const token = generateToken(user);\n\n    // Remove password hash from response\n    delete user.password_hash;\n\n    res.json({\n      success: true,\n      message: \"Login successful\",\n      data: {\n        user,\n        token,\n      },\n    });\n  } catch (error) {\n    console.error(\"Login error:\", error);\n\n    if (error instanceof z.ZodError) {\n      return res.status(400).json({\n        success: false,\n        message: \"Validation error\",\n        errors: error.errors,\n      });\n    }\n\n    res.status(500).json({\n      success: false,\n      message: \"Internal server error\",\n    });\n  }\n});\n\n// Get current user profile\nrouter.get(\"/me\", authenticate, async (req: Request, res: Response) => {\n  try {\n    // User is already verified by authenticate middleware\n    const user = req.user!;\n\n    res.json({\n      success: true,\n      message: \"User profile retrieved\",\n      data: user,\n    });\n  } catch (error) {\n    console.error(\"Get profile error:\", error);\n    res.status(500).json({\n      success: false,\n      message: \"Internal server error\",\n    });\n  }\n});\n\n// Logout endpoint (client-side mainly, but can log activity)\nrouter.post(\"/logout\", async (_req: Request, res: Response) => {\n  try {\n    // In a stateless JWT system, logout is mainly client-side\n    // But we can log the activity if user info is available\n\n    res.json({\n      success: true,\n      message: \"Logout successful\",\n    });\n  } catch (error) {\n    console.error(\"Logout error:\", error);\n    res.status(500).json({\n      success: false,\n      message: \"Internal server error\",\n    });\n  }\n});\n\nexport default router;\n","import { Router, Request, Response } from \"express\";\nimport { TicketRepository, ActivityLogRepository, CountryRepository, TicketBatchRepository } from \"../database/models\";\nimport { authenticate, hasPermission } from \"../middleware/auth\";\n\nconst router = Router();\n\n// Apply authentication to all routes\nrouter.use(authenticate);\n\n// Get all tickets\nrouter.get(\"/\", async (req: Request, res: Response) => {\n  try {\n    const { country, status, airline, limit = 50, offset = 0 } = req.query;\n\n    let tickets = TicketRepository.findAll();\n\n    // Apply filters\n    if (country) {\n      tickets = tickets.filter(\n        (ticket) => ticket.batch.country_code === country,\n      );\n    }\n\n    if (status) {\n      tickets = tickets.filter((ticket) => ticket.status === status);\n    }\n\n    if (airline) {\n      tickets = tickets.filter((ticket) =>\n        ticket.batch.airline_name\n          .toLowerCase()\n          .includes((airline as string).toLowerCase()),\n      );\n    }\n\n    // Apply pagination\n    const startIndex = parseInt(offset as string);\n    const endIndex = startIndex + parseInt(limit as string);\n    const paginatedTickets = tickets.slice(startIndex, endIndex);\n\n    // Remove buying price if user doesn't have permission\n    const userCanViewBuyingPrice = hasPermission(\n      req.user!.role,\n      \"view_buying_price\",\n    );\n    if (!userCanViewBuyingPrice) {\n      paginatedTickets.forEach((ticket) => {\n        if (ticket.batch) {\n          ticket.batch.buying_price = 0; // Set to 0 instead of undefined to maintain type consistency\n        }\n      });\n    }\n\n    res.json({\n      success: true,\n      message: \"Tickets retrieved successfully\",\n      data: {\n        tickets: paginatedTickets,\n        total: tickets.length,\n        limit: parseInt(limit as string),\n        offset: parseInt(offset as string),\n      },\n    });\n  } catch (error) {\n    console.error(\"Get tickets error:\", error);\n    res.status(500).json({\n      success: false,\n      message: \"Internal server error\",\n    });\n  }\n});\n\n// Get tickets by country\nrouter.get(\"/country/:countryCode\", async (req: Request, res: Response) => {\n  try {\n    const { countryCode } = req.params;\n    const { status, airline } = req.query;\n\n    let tickets = TicketRepository.findByCountry(countryCode.toUpperCase());\n\n    // Apply filters\n    if (status) {\n      tickets = tickets.filter((ticket) => ticket.status === status);\n    }\n\n    if (airline) {\n      tickets = tickets.filter((ticket) =>\n        ticket.batch.airline_name\n          .toLowerCase()\n          .includes((airline as string).toLowerCase()),\n      );\n    }\n\n    // Remove buying price if user doesn't have permission\n    const userCanViewBuyingPrice = hasPermission(\n      req.user!.role,\n      \"view_buying_price\",\n    );\n    if (!userCanViewBuyingPrice) {\n      tickets.forEach((ticket) => {\n        if (ticket.batch) {\n          ticket.batch.buying_price = 0; // Set to 0 instead of undefined to maintain type consistency\n        }\n      });\n    }\n\n    res.json({\n      success: true,\n      message: \"Country tickets retrieved successfully\",\n      data: {\n        tickets,\n        country: countryCode,\n        total: tickets.length,\n      },\n    });\n  } catch (error) {\n    console.error(\"Get country tickets error:\", error);\n    res.status(500).json({\n      success: false,\n      message: \"Internal server error\",\n    });\n  }\n});\n\n// Get single ticket by ID\nrouter.get(\"/:id\", async (req: Request, res: Response) => {\n  try {\n    const { id } = req.params;\n\n    const ticket = TicketRepository.findById(id);\n    if (!ticket) {\n      return res.status(404).json({\n        success: false,\n        message: \"Ticket not found\",\n      });\n    }\n\n    // Remove buying price for non-admin users\n    if (ticket.batch && !hasPermission(req.user!.role, \"view_buying_price\")) {\n      ticket.batch.buying_price = 0; // Set to 0 instead of undefined to maintain type consistency\n    }\n\n    res.json({\n      success: true,\n      message: \"Ticket retrieved successfully\",\n      data: { ticket },\n    });\n  } catch (error) {\n    console.error(\"Get ticket error:\", error);\n    res.status(500).json({\n      success: false,\n      message: \"Internal server error\",\n    });\n  }\n});\n\n// Update ticket status\nrouter.patch(\"/:id/status\", async (req: Request, res: Response) => {\n  try {\n    const { id } = req.params;\n    const { status } = req.body;\n\n    // Validate status\n    if (![\"available\", \"booked\", \"locked\", \"sold\"].includes(status)) {\n      return res.status(400).json({\n        success: false,\n        message: \"Invalid status\",\n      });\n    }\n\n    // Check permissions for certain status changes\n    if (status === \"sold\" && !hasPermission(req.user!.role, \"confirm_sales\")) {\n      return res.status(403).json({\n        success: false,\n        message: \"Permission required to mark tickets as sold\",\n      });\n    }\n\n    const ticket = TicketRepository.findById(id);\n    if (!ticket) {\n      return res.status(404).json({\n        success: false,\n        message: \"Ticket not found\",\n      });\n    }\n\n    const success = TicketRepository.updateStatus(\n      id,\n      status,\n      status === \"sold\" ? req.user!.id : undefined,\n    );\n\n    if (success) {\n      // Log activity\n      ActivityLogRepository.create({\n        user_id: req.user!.id,\n        action: \"update_ticket_status\",\n        entity_type: \"ticket\",\n        entity_id: id,\n        details: JSON.stringify({\n          old_status: ticket.status,\n          new_status: status,\n        }),\n        ip_address: req.ip || req.connection.remoteAddress,\n        user_agent: req.get(\"User-Agent\"),\n      });\n\n      res.json({\n        success: true,\n        message: \"Ticket status updated successfully\",\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: \"Failed to update ticket status\",\n      });\n    }\n  } catch (error) {\n    console.error(\"Update ticket status error:\", error);\n    res.status(500).json({\n      success: false,\n      message: \"Internal server error\",\n    });\n  }\n});\n\n// Get dashboard statistics\nrouter.get(\"/dashboard/stats\", async (req: Request, res: Response) => {\n  try {\n    const stats = TicketRepository.getDashboardStats();\n\n    // Remove estimated profit for non-admin users\n    if (!hasPermission(req.user!.role, \"view_profit\")) {\n      stats.estimatedProfit = 0; // Set to 0 instead of deleting\n    }\n\n    res.json({\n      success: true,\n      message: \"Dashboard statistics retrieved successfully\",\n      data: stats,\n    });\n  } catch (error) {\n    console.error(\"Get dashboard stats error:\", error);\n    res.status(500).json({\n      success: false,\n      message: \"Internal server error\",\n    });\n  }\n});\n\n// Get countries with ticket counts\nrouter.get(\"/countries/stats\", async (_req: Request, res: Response) => {\n  try {\n    const countries = CountryRepository.findAll();\n    const stats = TicketBatchRepository.getStatsByCountry();\n\n    const countriesWithStats = countries.map((country: any) => {\n      const countryStats = stats.find(\n        (stat: any) => stat.country_code === country.code,\n      );\n      return {\n        ...country,\n        totalTickets: countryStats?.total_tickets || 0,\n        availableTickets: countryStats?.available_tickets || 0,\n      };\n    });\n\n    res.json({\n      success: true,\n      message: \"Countries with statistics retrieved successfully\",\n      data: { countries: countriesWithStats },\n    });\n  } catch (error) {\n    console.error(\"Get countries stats error:\", error);\n    res.status(500).json({\n      success: false,\n      message: \"Internal server error\",\n    });\n  }\n});\n\nexport default router;\n","import { Router, Request, Response } from \"express\";\nimport { TicketBatchRepository, TicketRepository, ActivityLogRepository } from \"../database/models\";\nimport { authenticate, requirePermission } from \"../middleware/auth\";\nimport { z } from \"zod\";\n\nconst router = Router();\n\n// Apply authentication to all routes\nrouter.use(authenticate);\n\n// Schema for creating ticket batch\nconst createBatchSchema = z.object({\n  country: z.string().min(1, \"Country is required\"),\n  airline: z.string().min(1, \"Airline is required\"),\n  flightDate: z.string().min(1, \"Flight date is required\"),\n  flightTime: z.string().min(1, \"Flight time is required\"),\n  buyingPrice: z.number().min(0, \"Buying price must be positive\"),\n  quantity: z.number().min(1, \"Quantity must be at least 1\"),\n  agentName: z.string().min(1, \"Agent name is required\"),\n  agentContact: z.string().optional(),\n  agentAddress: z.string().optional(),\n  remarks: z.string().optional(),\n});\n\n// Get all ticket batches (admin only)\nrouter.get(\n  \"/\",\n  requirePermission(\"view_profit\"),\n  async (req: Request, res: Response) => {\n    try {\n      const { country, airline, dateFrom, dateTo } = req.query;\n\n      let batches = TicketBatchRepository.findAll();\n\n      // Apply filters\n      if (country) {\n        batches = batches.filter((batch) => batch.country_code === country);\n      }\n\n      if (airline) {\n        batches = batches.filter((batch) =>\n          batch.airline_name\n            .toLowerCase()\n            .includes((airline as string).toLowerCase()),\n        );\n      }\n\n      if (dateFrom) {\n        batches = batches.filter((batch) => batch.flight_date >= dateFrom);\n      }\n\n      if (dateTo) {\n        batches = batches.filter((batch) => batch.flight_date <= dateTo);\n      }\n\n      // Get ticket statistics for each batch\n      const batchesWithStats = batches.map((batch) => {\n        const tickets = TicketRepository.findAll().filter(\n          (ticket) => ticket.batch_id === batch.id,\n        );\n        const sold = tickets.filter(\n          (ticket) => ticket.status === \"sold\",\n        ).length;\n        const locked = tickets.filter(\n          (ticket) => ticket.status === \"locked\",\n        ).length;\n        const available = tickets.filter(\n          (ticket) => ticket.status === \"available\",\n        ).length;\n\n        // Calculate profit\n        const soldTickets = tickets.filter(\n          (ticket) => ticket.status === \"sold\",\n        );\n        const totalRevenue = soldTickets.reduce(\n          (sum, ticket) => sum + ticket.selling_price,\n          0,\n        );\n        const totalCost = sold * batch.buying_price;\n        const profit = totalRevenue - totalCost;\n\n        return {\n          ...batch,\n          sold,\n          locked,\n          available,\n          totalCost: batch.buying_price * batch.quantity,\n          profit,\n        };\n      });\n\n      res.json({\n        success: true,\n        message: \"Ticket batches retrieved successfully\",\n        data: {\n          batches: batchesWithStats,\n          total: batchesWithStats.length,\n        },\n      });\n    } catch (error) {\n      console.error(\"Get ticket batches error:\", error);\n      res.status(500).json({\n        success: false,\n        message: \"Internal server error\",\n      });\n    }\n  },\n);\n\n// Get single ticket batch by ID\nrouter.get(\n  \"/:id\",\n  requirePermission(\"view_profit\"),\n  async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n\n      const batch = TicketBatchRepository.findById(id);\n      if (!batch) {\n        return res.status(404).json({\n          success: false,\n          message: \"Ticket batch not found\",\n        });\n      }\n\n      // Get associated tickets\n      const tickets = TicketRepository.findAll().filter(\n        (ticket) => ticket.batch_id === id,\n      );\n\n      res.json({\n        success: true,\n        message: \"Ticket batch retrieved successfully\",\n        data: {\n          batch,\n          tickets,\n        },\n      });\n    } catch (error) {\n      console.error(\"Get ticket batch error:\", error);\n      res.status(500).json({\n        success: false,\n        message: \"Internal server error\",\n      });\n    }\n  },\n);\n\n// Create new ticket batch (admin only)\nrouter.post(\n  \"/\",\n  requirePermission(\"create_batches\"),\n  async (req: Request, res: Response) => {\n    try {\n      const batchData = createBatchSchema.parse(req.body);\n\n      // Create the ticket batch\n      const batch = TicketBatchRepository.create({\n        country_code: batchData.country.toUpperCase(),\n        airline_name: batchData.airline,\n        flight_date: batchData.flightDate,\n        flight_time: batchData.flightTime,\n        buying_price: batchData.buyingPrice,\n        quantity: batchData.quantity,\n        agent_name: batchData.agentName,\n        agent_contact: batchData.agentContact,\n        agent_address: batchData.agentAddress,\n        remarks: batchData.remarks,\n        created_by: req.user!.id,\n      });\n\n      // Create individual tickets for this batch\n      const createdTickets = [];\n      for (let i = 1; i <= batchData.quantity; i++) {\n        // Generate flight number (simplified)\n        const airlineCode =\n          batchData.airline === \"Air Arabia\"\n            ? \"G9\"\n            : batchData.airline === \"Emirates\"\n              ? \"EK\"\n              : batchData.airline === \"Qatar Airways\"\n                ? \"QR\"\n                : batchData.airline === \"Saudi Airlines\"\n                  ? \"SV\"\n                  : batchData.airline === \"Flydubai\"\n                    ? \"FZ\"\n                    : \"XX\";\n\n        const flightNumber = `${airlineCode} ${Math.floor(Math.random() * 900) + 100}`;\n        const sellingPrice = Math.floor(batchData.buyingPrice * 1.2); // 20% markup default\n\n        const ticket = TicketRepository.create({\n          batch_id: batch.id,\n          flight_number: flightNumber,\n          status: \"available\",\n          selling_price: sellingPrice,\n          aircraft:\n            batchData.airline === \"Air Arabia\"\n              ? \"Airbus A320\"\n              : batchData.airline === \"Emirates\"\n                ? \"Boeing 777\"\n                : batchData.airline === \"Qatar Airways\"\n                  ? \"Boeing 787\"\n                  : \"Airbus A321\",\n          terminal: `Terminal ${Math.floor(Math.random() * 3) + 1}`,\n          arrival_time: \"18:45\", // Default arrival time\n          duration: \"4h 15m\", // Default duration\n          available_seats: 1,\n          total_seats: 1,\n        });\n\n        createdTickets.push(ticket);\n      }\n\n      // Log activity\n      ActivityLogRepository.create({\n        user_id: req.user!.id,\n        action: \"create_ticket_batch\",\n        entity_type: \"ticket_batch\",\n        entity_id: batch.id,\n        details: JSON.stringify({\n          airline: batchData.airline,\n          country: batchData.country,\n          quantity: batchData.quantity,\n          buying_price: batchData.buyingPrice,\n        }),\n        ip_address: req.ip || req.connection.remoteAddress,\n        user_agent: req.get(\"User-Agent\"),\n      });\n\n      res.status(201).json({\n        success: true,\n        message: \"Ticket batch created successfully\",\n        data: {\n          batch,\n          ticketsCreated: createdTickets.length,\n        },\n      });\n    } catch (error) {\n      console.error(\"Create ticket batch error:\", error);\n\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({\n          success: false,\n          message: \"Validation error\",\n          errors: error.errors,\n        });\n      }\n\n      res.status(500).json({\n        success: false,\n        message: \"Internal server error\",\n      });\n    }\n  },\n);\n\n// Update ticket batch (admin only)\nrouter.put(\n  \"/:id\",\n  requirePermission(\"edit_batches\"),\n  async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n\n      const batch = TicketBatchRepository.findById(id);\n      if (!batch) {\n        return res.status(404).json({\n          success: false,\n          message: \"Ticket batch not found\",\n        });\n      }\n\n      // Note: In a real implementation, you'd want to update the batch\n      // For now, we'll just return a success message\n      res.json({\n        success: true,\n        message: \"Ticket batch updated successfully\",\n      });\n    } catch (error) {\n      console.error(\"Update ticket batch error:\", error);\n      res.status(500).json({\n        success: false,\n        message: \"Internal server error\",\n      });\n    }\n  },\n);\n\n// Delete ticket batch (admin only)\nrouter.delete(\n  \"/:id\",\n  requirePermission(\"delete_batches\"),\n  async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n\n      const batch = TicketBatchRepository.findById(id);\n      if (!batch) {\n        return res.status(404).json({\n          success: false,\n          message: \"Ticket batch not found\",\n        });\n      }\n\n      // Check if any tickets are already sold\n      const tickets = TicketRepository.findAll().filter(\n        (ticket) => ticket.batch_id === id,\n      );\n      const hasSoldTickets = tickets.some((ticket) => ticket.status === \"sold\");\n\n      if (hasSoldTickets) {\n        return res.status(400).json({\n          success: false,\n          message: \"Cannot delete batch with sold tickets\",\n        });\n      }\n\n      // Note: In a real implementation, you'd want to delete the batch and associated tickets\n      // For now, we'll just return a success message\n      res.json({\n        success: true,\n        message: \"Ticket batch deleted successfully\",\n      });\n    } catch (error) {\n      console.error(\"Delete ticket batch error:\", error);\n      res.status(500).json({\n        success: false,\n        message: \"Internal server error\",\n      });\n    }\n  },\n);\n\nexport default router;\n","import { Router, Request, Response } from \"express\";\nimport {\n  BookingRepository,\n  TicketRepository,\n  ActivityLogRepository,\n} from \"../database/models\";\nimport { authenticate, hasPermission } from \"../middleware/auth\";\nimport { z } from \"zod\";\n\nconst router = Router();\n\n// Apply authentication to all routes\nrouter.use(authenticate);\n\n// Schema for creating booking\nconst createBookingSchema = z.object({\n  ticketId: z.string().min(1, \"Ticket ID is required\"),\n  agentInfo: z.object({\n    name: z.string().min(1, \"Agent name is required\"),\n    phone: z.string().optional(),\n    email: z.string().email().optional(),\n  }),\n  passengerInfo: z.object({\n    name: z.string().min(1, \"Passenger name is required\"),\n    passportNo: z.string().min(1, \"Passport number is required\"),\n    phone: z.string().min(1, \"Passenger phone is required\"),\n    paxCount: z.number().min(1, \"Passenger count must be at least 1\"),\n    email: z.string().email().optional(),\n  }),\n  sellingPrice: z.number().min(0, \"Selling price must be positive\"),\n  paymentType: z.enum([\"full\", \"partial\"]),\n  partialAmount: z.number().min(0).optional(),\n  paymentMethod: z.string().default(\"cash\"),\n  paymentDetails: z.string().optional(),\n  comments: z.string().optional(),\n});\n\n// Get all bookings\nrouter.get(\"/\", async (req: Request, res: Response) => {\n  try {\n    const { status, limit = 50, offset = 0 } = req.query;\n\n    let bookings;\n\n    // Check if user can view all bookings or just their own\n    if (hasPermission(req.user!.role, \"view_all_bookings\")) {\n      bookings = BookingRepository.findAllForFrontend();\n    } else {\n      const userBookings = BookingRepository.findByUser(req.user!.id);\n      bookings = userBookings.map(booking => BookingRepository.transformForFrontend(booking));\n    }\n\n    // Apply status filter\n    if (status) {\n      bookings = bookings.filter((booking) => booking.status === status);\n    }\n\n    // Apply pagination\n    const startIndex = parseInt(offset as string);\n    const endIndex = startIndex + parseInt(limit as string);\n    const paginatedBookings = bookings.slice(startIndex, endIndex);\n\n    res.json({\n      success: true,\n      message: \"Bookings retrieved successfully\",\n      data: {\n        bookings: paginatedBookings,\n        total: bookings.length,\n        limit: parseInt(limit as string),\n        offset: parseInt(offset as string),\n      },\n    });\n  } catch (error) {\n    console.error(\"Get bookings error:\", error);\n    res.status(500).json({\n      success: false,\n      message: \"Internal server error\",\n    });\n  }\n});\n\n// Get single booking by ID\nrouter.get(\"/:id\", async (req: Request, res: Response) => {\n  try {\n    const { id } = req.params;\n\n    const booking = BookingRepository.findById(id);\n    if (!booking) {\n      return res.status(404).json({\n        success: false,\n        message: \"Booking not found\",\n      });\n    }\n\n    // Check if user can access this booking\n    const canViewAllBookings = hasPermission(\n      req.user!.role,\n      \"view_all_bookings\",\n    );\n    if (!canViewAllBookings && booking.created_by !== req.user!.id) {\n      return res.status(403).json({\n        success: false,\n        message: \"Access denied\",\n      });\n    }\n\n    // Get associated ticket info\n    const ticket = TicketRepository.findById(booking.ticket_id);\n\n    res.json({\n      success: true,\n      message: \"Booking retrieved successfully\",\n      data: {\n        booking,\n        ticket,\n      },\n    });\n  } catch (error) {\n    console.error(\"Get booking error:\", error);\n    res.status(500).json({\n      success: false,\n      message: \"Internal server error\",\n    });\n  }\n});\n\n// Create new booking\nrouter.post(\"/\", async (req: Request, res: Response) => {\n  try {\n    const bookingData = createBookingSchema.parse(req.body);\n\n    // Check if ticket exists and is available\n    const ticket = TicketRepository.findById(bookingData.ticketId);\n    if (!ticket) {\n      return res.status(404).json({\n        success: false,\n        message: \"Ticket not found\",\n      });\n    }\n\n    if (ticket.status !== \"available\") {\n      return res.status(400).json({\n        success: false,\n        message: \"Ticket is not available for booking\",\n      });\n    }\n\n    // Validate partial payment amount\n    if (bookingData.paymentType === \"partial\") {\n      if (!bookingData.partialAmount || bookingData.partialAmount <= 0) {\n        return res.status(400).json({\n          success: false,\n          message: \"Partial amount is required for partial payments\",\n        });\n      }\n\n      const totalAmount =\n        bookingData.sellingPrice * bookingData.passengerInfo.paxCount;\n      if (bookingData.partialAmount >= totalAmount) {\n        return res.status(400).json({\n          success: false,\n          message:\n            \"Partial amount cannot be greater than or equal to total amount\",\n        });\n      }\n    }\n\n    // Create the booking\n    const booking = BookingRepository.create({\n      ticket_id: bookingData.ticketId,\n      agent_name: bookingData.agentInfo.name,\n      agent_phone: bookingData.agentInfo.phone,\n      agent_email: bookingData.agentInfo.email,\n      passenger_name: bookingData.passengerInfo.name,\n      passenger_passport: bookingData.passengerInfo.passportNo,\n      passenger_phone: bookingData.passengerInfo.phone,\n      passenger_email: bookingData.passengerInfo.email,\n      pax_count: bookingData.passengerInfo.paxCount,\n      selling_price: bookingData.sellingPrice,\n      payment_type: bookingData.paymentType,\n      partial_amount: bookingData.partialAmount,\n      payment_method: bookingData.paymentMethod,\n      payment_details: bookingData.paymentDetails,\n      comments: bookingData.comments,\n      status: bookingData.paymentType === \"full\" ? \"confirmed\" : \"pending\",\n      created_by: req.user!.id,\n    });\n\n    // Update ticket status\n    const newTicketStatus =\n      bookingData.paymentType === \"full\" ? \"sold\" : \"locked\";\n    TicketRepository.updateStatus(\n      bookingData.ticketId,\n      newTicketStatus,\n      bookingData.paymentType === \"full\" ? req.user!.id : undefined,\n    );\n\n    // Log activity\n    ActivityLogRepository.create({\n      user_id: req.user!.id,\n      action: \"create_booking\",\n      entity_type: \"booking\",\n      entity_id: booking.id,\n      details: JSON.stringify({\n        ticket_id: bookingData.ticketId,\n        passenger_name: bookingData.passengerInfo.name,\n        payment_type: bookingData.paymentType,\n        amount:\n          bookingData.paymentType === \"full\"\n            ? bookingData.sellingPrice * bookingData.passengerInfo.paxCount\n            : bookingData.partialAmount,\n      }),\n      ip_address: req.ip || req.connection.remoteAddress,\n      user_agent: req.get(\"User-Agent\"),\n    });\n\n    res.status(201).json({\n      success: true,\n      message: \"Booking created successfully\",\n      data: {\n        booking,\n        bookingId: booking.id,\n      },\n    });\n  } catch (error) {\n    console.error(\"Create booking error:\", error);\n\n    if (error instanceof z.ZodError) {\n      return res.status(400).json({\n        success: false,\n        message: \"Validation error\",\n        errors: error.errors,\n      });\n    }\n\n    res.status(500).json({\n      success: false,\n      message: \"Internal server error\",\n    });\n  }\n});\n\n// Update booking status\nrouter.patch(\"/:id/status\", async (req: Request, res: Response) => {\n  try {\n    console.log(\"Updating booking status:\", { id: req.params.id, status: req.body.status });\n    const { id } = req.params;\n    const { status } = req.body;\n\n    // Validate status\n    if (![\"pending\", \"confirmed\", \"cancelled\", \"expired\"].includes(status)) {\n      return res.status(400).json({\n        success: false,\n        message: \"Invalid status\",\n      });\n    }\n\n    console.log(\"Finding booking with ID:\", id);\n    const booking = BookingRepository.findById(id);\n    if (!booking) {\n      console.log(\"Booking not found:\", id);\n      return res.status(404).json({\n        success: false,\n        message: \"Booking not found\",\n      });\n    }\n    console.log(\"Found booking:\", { id: booking.id, current_status: booking.status });\n\n    // Check permissions\n    const canViewAllBookings = hasPermission(\n      req.user!.role,\n      \"view_all_bookings\",\n    );\n    if (!canViewAllBookings && booking.created_by !== req.user!.id) {\n      return res.status(403).json({\n        success: false,\n        message: \"Access denied\",\n      });\n    }\n\n    // Check if user can confirm sales\n    if (\n      status === \"confirmed\" &&\n      !hasPermission(req.user!.role, \"confirm_sales\")\n    ) {\n      return res.status(403).json({\n        success: false,\n        message: \"Permission required to confirm bookings\",\n      });\n    }\n\n    // Update booking status\n    console.log(\"Attempting to update booking status:\", { id, from: booking.status, to: status });\n    let success;\n    try {\n      success = BookingRepository.updateStatus(id, status);\n      console.log(\"Booking status update result:\", success);\n    } catch (error) {\n      console.error(\"Error updating booking status:\", error);\n      return res.status(500).json({\n        success: false,\n        message: \"Database error updating booking status\",\n      });\n    }\n\n    if (success) {\n      // Update associated ticket status\n      let newTicketStatus: \"available\" | \"sold\" | \"locked\" = \"available\";\n\n      try {\n        if (status === \"confirmed\") {\n          newTicketStatus = \"sold\";\n          TicketRepository.updateStatus(\n            booking.ticket_id,\n            newTicketStatus,\n            req.user!.id,\n          );\n        } else if (status === \"cancelled\" || status === \"expired\") {\n          newTicketStatus = \"available\";\n          TicketRepository.updateStatus(booking.ticket_id, newTicketStatus);\n        }\n      } catch (error) {\n        console.error(\"Error updating ticket status:\", error);\n        // Continue anyway, booking status was already updated\n      }\n\n      // Log activity (temporarily disabled for debugging)\n      try {\n        ActivityLogRepository.create({\n          user_id: req.user!.id,\n          action: \"update_booking_status\",\n          entity_type: \"booking\",\n          entity_id: id,\n          details: JSON.stringify({\n            old_status: booking.status,\n            new_status: status,\n            ticket_status: newTicketStatus,\n          }),\n          ip_address: req.ip || \"127.0.0.1\",\n          user_agent: req.get(\"User-Agent\") || \"Unknown\",\n        });\n      } catch (activityError) {\n        console.error(\"Activity logging failed:\", activityError);\n        // Continue without logging activity\n      }\n\n      res.json({\n        success: true,\n        message: \"Booking status updated successfully\",\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: \"Failed to update booking status\",\n      });\n    }\n  } catch (error) {\n    console.error(\"Update booking status error:\", error);\n    res.status(500).json({\n      success: false,\n      message: \"Internal server error\",\n    });\n  }\n});\n\n// Cancel booking\nrouter.delete(\"/:id\", async (req: Request, res: Response) => {\n  try {\n    const { id } = req.params;\n\n    const booking = BookingRepository.findById(id);\n    if (!booking) {\n      return res.status(404).json({\n        success: false,\n        message: \"Booking not found\",\n      });\n    }\n\n    // Check permissions\n    const canViewAllBookings = hasPermission(\n      req.user!.role,\n      \"view_all_bookings\",\n    );\n    if (!canViewAllBookings && booking.created_by !== req.user!.id) {\n      return res.status(403).json({\n        success: false,\n        message: \"Access denied\",\n      });\n    }\n\n    // Don't allow cancellation of confirmed bookings without proper permission\n    if (\n      booking.status === \"confirmed\" &&\n      !hasPermission(req.user!.role, \"override_locks\")\n    ) {\n      return res.status(400).json({\n        success: false,\n        message: \"Cannot cancel confirmed booking without override permission\",\n      });\n    }\n\n    // Update booking status to cancelled\n    BookingRepository.updateStatus(id, \"cancelled\");\n\n    // Make ticket available again\n    TicketRepository.updateStatus(booking.ticket_id, \"available\");\n\n    // Log activity\n    ActivityLogRepository.create({\n      user_id: req.user!.id,\n      action: \"cancel_booking\",\n      entity_type: \"booking\",\n      entity_id: id,\n      details: JSON.stringify({\n        reason: \"manual_cancellation\",\n      }),\n      ip_address: req.ip || req.connection.remoteAddress,\n      user_agent: req.get(\"User-Agent\"),\n    });\n\n    res.json({\n      success: true,\n      message: \"Booking cancelled successfully\",\n    });\n  } catch (error) {\n    console.error(\"Cancel booking error:\", error);\n    res.status(500).json({\n      success: false,\n      message: \"Internal server error\",\n    });\n  }\n});\n\nexport default router;\n","import { Router, Request, Response } from \"express\";\n\n// Extend the Express Request interface to include user property\ndeclare global {\n  namespace Express {\n    interface Request {\n      user?: {\n        id: string;\n        name: string;\n        role: string;\n      };\n    }\n  }\n}\nimport { UserRepository, ActivityLogRepository } from \"../database/models\";\nimport { authenticate, requirePermission } from \"../middleware/auth\";\nimport { z } from \"zod\";\n\nconst router = Router();\n\n// Apply authentication to all routes\nrouter.use(authenticate);\n\n// Schema for creating user\nconst createUserSchema = z.object({\n  username: z.string().min(3, \"Username must be at least 3 characters\"),\n  password: z.string().min(6, \"Password must be at least 6 characters\"),\n  name: z.string().min(1, \"Name is required\"),\n  email: z.string().email(\"Invalid email\").optional(),\n  phone: z.string().optional(),\n  role: z.enum([\"admin\", \"manager\", \"staff\"]),\n  status: z.enum([\"active\", \"inactive\"]).default(\"active\"),\n});\n\n// Schema for updating user\nconst updateUserSchema = z.object({\n  name: z.string().min(1).optional(),\n  email: z.string().email().optional(),\n  phone: z.string().optional(),\n  role: z.enum([\"admin\", \"manager\", \"staff\"]).optional(),\n  status: z.enum([\"active\", \"inactive\"]).optional(),\n});\n\n// Schema for updating password\nconst updatePasswordSchema = z\n  .object({\n    currentPassword: z.string().min(1, \"Current password is required\"),\n    newPassword: z\n      .string()\n      .min(6, \"New password must be at least 6 characters\"),\n    confirmPassword: z.string().min(1, \"Password confirmation is required\"),\n  })\n  .refine((data) => data.newPassword === data.confirmPassword, {\n    message: \"Passwords don't match\",\n    path: [\"confirmPassword\"],\n  });\n\n// Get all users (admin only)\nrouter.get(\n  \"/\",\n  requirePermission(\"manage_users\"),\n  async (_req: Request, res: Response) => {\n    try {\n      const users = UserRepository.findAll();\n\n      // Remove password hashes from response\n      const safeUsers = users.map((user) => {\n        const { password_hash, ...safeUser } = user;\n        return safeUser;\n      });\n\n      res.json({\n        success: true,\n        message: \"Users retrieved successfully\",\n        data: { users: safeUsers },\n      });\n    } catch (error) {\n      console.error(\"Get users error:\", error);\n      res.status(500).json({\n        success: false,\n        message: \"Internal server error\",\n      });\n    }\n  },\n);\n\n// Get single user by ID\nrouter.get(\n  \"/:id\",\n  requirePermission(\"manage_users\"),\n  async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n\n      const user = UserRepository.findById(id);\n      if (!user) {\n        return res.status(404).json({\n          success: false,\n          message: \"User not found\",\n        });\n      }\n\n      // Remove password hash from response\n      const { password_hash, ...safeUser } = user;\n\n      res.json({\n        success: true,\n        message: \"User retrieved successfully\",\n        data: { user: safeUser },\n      });\n    } catch (error) {\n      console.error(\"Get user error:\", error);\n      res.status(500).json({\n        success: false,\n        message: \"Internal server error\",\n      });\n    }\n  },\n);\n\n// Get current user profile\nrouter.get(\"/me\", async (_req: Request, res: Response) => {\n  try {\n    const user = UserRepository.findById(res.locals.user.id);\n\n    if (!user) {\n      return res.status(404).json({\n        success: false,\n        message: \"User not found\",\n      });\n    }\n\n    // Remove password hash from response\n    const { password_hash, ...safeUser } = user;\n\n    res.json({\n      success: true,\n      message: \"User retrieved successfully\",\n      data: { user: safeUser },\n    });\n  } catch (error) {\n    console.error(\"Get user error:\", error);\n    res.status(500).json({\n      success: false,\n      message: \"Internal server error\",\n    });\n  }\n});\n\n// Create new user (admin only)\nrouter.post(\n  \"/\",\n  requirePermission(\"manage_users\"),\n  async (req: Request, res: Response) => {\n    try {\n      const userData = createUserSchema.parse(req.body);\n\n      // Check if username already exists\n      const existingUser = UserRepository.findByUsername(userData.username);\n      if (existingUser) {\n        return res.status(400).json({\n          success: false,\n          message: \"Username already exists\",\n        });\n      }\n\n      // Create the user\n      const user = UserRepository.create({\n        username: userData.username,\n        password: userData.password,\n        name: userData.name,\n        email: userData.email,\n        phone: userData.phone,\n        role: userData.role,\n        status: userData.status,\n      });\n\n      // Log activity\n      ActivityLogRepository.create({\n        user_id: req.user!.id,\n        action: \"create_user\",\n        entity_type: \"user\",\n        entity_id: user.id,\n        details: JSON.stringify({\n          username: userData.username,\n          role: userData.role,\n          created_by: req.user!.name,\n        }),\n        ip_address: req.ip || req.connection.remoteAddress,\n        user_agent: req.get(\"User-Agent\"),\n      });\n\n      // Remove password hash from response\n      const { password_hash, ...safeUser } = user;\n\n      res.status(201).json({\n        success: true,\n        message: \"User created successfully\",\n        data: { user: safeUser },\n      });\n    } catch (error) {\n      console.error(\"Create user error:\", error);\n\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({\n          success: false,\n          message: \"Validation error\",\n          errors: error.errors,\n        });\n      }\n\n      res.status(500).json({\n        success: false,\n        message: \"Internal server error\",\n      });\n    }\n  },\n);\n\n// Update user (admin only)\nrouter.put(\n  \"/:id\",\n  requirePermission(\"manage_users\"),\n  async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const updates = updateUserSchema.parse(req.body);\n\n      const user = UserRepository.findById(id);\n      if (!user) {\n        return res.status(404).json({\n          success: false,\n          message: \"User not found\",\n        });\n      }\n\n      // Prevent admin from changing their own role to non-admin\n      if (id === req.user!.id && updates.role && updates.role !== \"admin\") {\n        return res.status(400).json({\n          success: false,\n          message: \"Cannot change your own admin role\",\n        });\n      }\n\n      const updatedUser = UserRepository.update(id, updates);\n\n      if (updatedUser) {\n        // Log activity\n        ActivityLogRepository.create({\n          user_id: req.user!.id,\n          action: \"update_user\",\n          entity_type: \"user\",\n          entity_id: id,\n          details: JSON.stringify({\n            updates,\n            updated_by: req.user!.name,\n          }),\n          ip_address: req.ip || req.connection.remoteAddress,\n          user_agent: req.get(\"User-Agent\"),\n        });\n\n        // Remove password hash from response\n        const { password_hash, ...safeUser } = updatedUser;\n\n        res.json({\n          success: true,\n          message: \"User updated successfully\",\n          data: { user: safeUser },\n        });\n      } else {\n        res.status(500).json({\n          success: false,\n          message: \"Failed to update user\",\n        });\n      }\n    } catch (error) {\n      console.error(\"Update user error:\", error);\n\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({\n          success: false,\n          message: \"Validation error\",\n          errors: error.errors,\n        });\n      }\n\n      res.status(500).json({\n        success: false,\n        message: \"Internal server error\",\n      });\n    }\n  },\n);\n\n// Update current user profile\nrouter.put(\"/profile/me\", async (req: Request, res: Response) => {\n  try {\n    const updates = z\n      .object({\n        name: z.string().min(1).optional(),\n        email: z.string().email().optional(),\n        phone: z.string().optional(),\n      })\n      .parse(req.body);\n\n    const updatedUser = UserRepository.update(req.user!.id, updates);\n\n    if (updatedUser) {\n      // Remove password hash from response\n      const { password_hash, ...safeUser } = updatedUser;\n\n      res.json({\n        success: true,\n        message: \"Profile updated successfully\",\n        data: { user: safeUser },\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        message: \"Failed to update profile\",\n      });\n    }\n  } catch (error) {\n    console.error(\"Update profile error:\", error);\n\n    if (error instanceof z.ZodError) {\n      return res.status(400).json({\n        success: false,\n        message: \"Validation error\",\n        errors: error.errors,\n      });\n    }\n\n    res.status(500).json({\n      success: false,\n      message: \"Internal server error\",\n    });\n  }\n});\n\n// Update password\nrouter.put(\"/profile/password\", async (req: Request, res: Response) => {\n  try {\n    const { currentPassword, newPassword } = updatePasswordSchema.parse(\n      req.body,\n    );\n\n    const user = UserRepository.findById(req.user!.id);\n    if (!user) {\n      return res.status(404).json({\n        success: false,\n        message: \"User not found\",\n      });\n    }\n\n    // Verify current password\n    if (!UserRepository.verifyPassword(currentPassword, user.password_hash!)) {\n      return res.status(400).json({\n        success: false,\n        message: \"Current password is incorrect\",\n      });\n    }\n\n    // Update password\n    const bcrypt = require(\"bcryptjs\");\n    const newPasswordHash = bcrypt.hashSync(newPassword, 10);\n\n    UserRepository.update(req.user!.id, { password_hash: newPasswordHash });\n\n    // Log activity\n    ActivityLogRepository.create({\n      user_id: req.user!.id,\n      action: \"update_password\",\n      entity_type: \"user\",\n      entity_id: req.user!.id,\n      ip_address: req.ip || req.connection.remoteAddress,\n      user_agent: req.get(\"User-Agent\"),\n    });\n\n    res.json({\n      success: true,\n      message: \"Password updated successfully\",\n    });\n  } catch (error) {\n    console.error(\"Update password error:\", error);\n\n    if (error instanceof z.ZodError) {\n      return res.status(400).json({\n        success: false,\n        message: \"Validation error\",\n        errors: error.errors,\n      });\n    }\n\n    res.status(500).json({\n      success: false,\n      message: \"Internal server error\",\n    });\n  }\n});\n\n// Delete user (admin only)\nrouter.delete(\n  \"/:id\",\n  requirePermission(\"manage_users\"),\n  async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n\n      if (id === req.user!.id) {\n        return res.status(400).json({\n          success: false,\n          message: \"Cannot delete your own account\",\n        });\n      }\n\n      const user = UserRepository.findById(id);\n      if (!user) {\n        return res.status(404).json({\n          success: false,\n          message: \"User not found\",\n        });\n      }\n\n      const success = UserRepository.delete(id);\n\n      if (success) {\n        // Log activity\n        ActivityLogRepository.create({\n          user_id: req.user!.id,\n          action: \"delete_user\",\n          entity_type: \"user\",\n          entity_id: id,\n          details: JSON.stringify({\n            deleted_username: user.username,\n            deleted_by: req.user!.name,\n          }),\n          ip_address: req.ip || req.connection.remoteAddress,\n          user_agent: req.get(\"User-Agent\"),\n        });\n\n        res.json({\n          success: true,\n          message: \"User deleted successfully\",\n        });\n      } else {\n        res.status(500).json({\n          success: false,\n          message: \"Failed to delete user\",\n        });\n      }\n    } catch (error) {\n      console.error(\"Delete user error:\", error);\n      res.status(500).json({\n        success: false,\n        message: \"Internal server error\",\n      });\n    }\n  },\n);\n\nexport default router;\n","import { Router, Request, Response } from \"express\";\nimport {\n  SystemSettingsRepository,\n  ActivityLogRepository,\n} from \"../database/models\";\nimport {\n  authenticate,\n  requirePermission,\n  hasPermission,\n} from \"../middleware/auth\";\nimport { z } from \"zod\";\nimport * as os from \"os\";\nimport * as fs from \"fs\";\nimport * as path from \"path\";\n\nconst router = Router();\n\n// Apply authentication to all routes\nrouter.use(authenticate);\n\n// Add middleware to log all requests to settings routes\nrouter.use((_req, _res, next) => {\n  console.log(`Settings route accessed: ${_req.method} ${_req.path}`);\n  next();\n});\n\n// Test endpoint to verify routing works\nrouter.get(\"/test\", (_req: Request, res: Response) => {\n  console.log(\"Test endpoint called successfully!\");\n  res.json({\n    success: true,\n    message: \"Settings route test successful\",\n    timestamp: new Date().toISOString(),\n  });\n});\n\n// Schema for updating system settings\nconst updateSettingsSchema = z.object({\n  company_name: z.string().min(1).optional(),\n  company_email: z.string().email().optional(),\n  company_phone: z.string().optional(),\n  company_address: z.string().optional(),\n  default_currency: z.enum([\"BDT\", \"USD\", \"EUR\"]).optional(),\n  timezone: z.string().optional(),\n  language: z.enum([\"en\", \"bn\", \"ar\"]).optional(),\n  auto_backup: z.boolean().optional(),\n  email_notifications: z.boolean().optional(),\n  sms_notifications: z.boolean().optional(),\n  booking_timeout: z.number().min(1).max(48).optional(),\n});\n\n// Get system settings (basic info for all users, full settings for admins)\nrouter.get(\"/\", async (req: Request, res: Response) => {\n  try {\n    const settingsRecord = SystemSettingsRepository.findAll();\n\n    // Convert Record to array format expected by client\n    const settingsArray = Object.entries(settingsRecord).map(([key, value]) => ({\n      key,\n      value,\n    }));\n\n    // Filter settings based on user permissions\n    let filteredSettings = settingsArray;\n\n    // If user doesn't have system_settings permission, only return basic company info\n    if (!req.user || !hasPermission(req.user.role, \"system_settings\")) {\n      const allowedKeys = [\n        \"company_name\",\n        \"company_email\",\n        \"company_phone\",\n        \"company_address\",\n        \"default_currency\",\n        \"timezone\",\n        \"language\",\n      ];\n      filteredSettings = settingsArray.filter((setting) =>\n        allowedKeys.includes(setting.key),\n      );\n    }\n\n    res.json({\n      success: true,\n      message: \"System settings retrieved successfully\",\n      data: { settings: filteredSettings },\n    });\n  } catch (error: unknown) {\n    console.error(\"Get settings error:\", error);\n    res.status(500).json({\n      success: false,\n      message: \"Internal server error\",\n      error: error instanceof Error ? error.message : 'Unknown error',\n    });\n  }\n});\n\n// Get specific setting by key\nrouter.get(\"/:key\", async (req: Request, res: Response) => {\n  try {\n    const { key } = req.params;\n\n    // Allow certain settings to be viewed by all authenticated users\n    const publicSettings = [\n      \"company_name\",\n      \"default_currency\",\n      \"timezone\",\n      \"language\",\n      \"booking_timeout\",\n    ];\n\n    if (!publicSettings.includes(key) && req.user!.role !== \"admin\") {\n      return res.status(403).json({\n        success: false,\n        message: \"Access denied\",\n      });\n    }\n\n    const value = SystemSettingsRepository.get(key);\n\n    if (value === undefined) {\n      return res.status(404).json({\n        success: false,\n        message: \"Setting not found\",\n      });\n    }\n\n    res.json({\n      success: true,\n      message: \"Setting retrieved successfully\",\n      data: { key, value },\n    });\n  } catch (error: unknown) {\n    console.error(\"Get setting error:\", error);\n    res.status(500).json({\n      success: false,\n      message: \"Internal server error\",\n      error: error instanceof Error ? error.message : 'Unknown error',\n    });\n  }\n});\n\n// Update system settings (admin only)\nrouter.put(\n  \"/\",\n  requirePermission(\"system_settings\"),\n  async (req: Request, res: Response) => {\n    try {\n      const updates = updateSettingsSchema.parse(req.body);\n\n      // Convert boolean values to strings for storage\n      const settingsToUpdate: Record<string, string> = {};\n\n      for (const [key, value] of Object.entries(updates)) {\n        if (value !== undefined) {\n          settingsToUpdate[key] =\n            typeof value === \"boolean\" ? value.toString() : value.toString();\n        }\n      }\n\n      // Update settings\n      SystemSettingsRepository.setBatch(settingsToUpdate);\n\n      // Log activity\n      ActivityLogRepository.create({\n        user_id: req.user!.id,\n        action: \"update_settings\",\n        entity_type: \"system_settings\",\n        details: JSON.stringify({\n          updates: settingsToUpdate,\n          updated_by: req.user!.name,\n        }),\n        ip_address: req.ip || req.connection.remoteAddress,\n        user_agent: req.get(\"User-Agent\"),\n      });\n\n      res.json({\n        success: true,\n        message: \"System settings updated successfully\",\n      });\n    } catch (error) {\n      console.error(\"Update settings error:\", error);\n\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({\n          success: false,\n          message: \"Validation error\",\n          errors: error.errors,\n        });\n      }\n\n      res.status(500).json({\n        success: false,\n        message: \"Internal server error\",\n        error: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  },\n);\n\n// Update single setting (admin only)\nrouter.put(\n  \"/:key\",\n  requirePermission(\"system_settings\"),\n  async (req: Request, res: Response) => {\n    try {\n      const { key } = req.params;\n      const { value } = req.body;\n\n      if (value === undefined || value === null) {\n        return res.status(400).json({\n          success: false,\n          message: \"Value is required\",\n        });\n      }\n\n      // Validate specific settings\n      const validSettings = [\n        \"company_name\",\n        \"company_email\",\n        \"company_phone\",\n        \"company_address\",\n        \"default_currency\",\n        \"timezone\",\n        \"language\",\n        \"auto_backup\",\n        \"email_notifications\",\n        \"sms_notifications\",\n        \"booking_timeout\",\n      ];\n\n      if (!validSettings.includes(key)) {\n        return res.status(400).json({\n          success: false,\n          message: \"Invalid setting key\",\n        });\n      }\n\n      // Convert value to string for storage\n      const stringValue =\n        typeof value === \"boolean\" ? value.toString() : value.toString();\n\n      SystemSettingsRepository.set(key, stringValue);\n\n      // Log activity\n      ActivityLogRepository.create({\n        user_id: req.user!.id,\n        action: \"update_setting\",\n        entity_type: \"system_settings\",\n        details: JSON.stringify({\n          key,\n          old_value: SystemSettingsRepository.get(key),\n          new_value: stringValue,\n          updated_by: req.user!.name,\n        }),\n        ip_address: req.ip || req.connection.remoteAddress,\n        user_agent: req.get(\"User-Agent\"),\n      });\n\n      res.json({\n        success: true,\n        message: \"Setting updated successfully\",\n      });\n    } catch (error) {\n      console.error(\"Update setting error:\", error);\n      res.status(500).json({\n        success: false,\n        message: \"Internal server error\",\n        error: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  },\n);\n\n// Export data (admin only)\nrouter.get(\n  \"/export/data\",\n  requirePermission(\"system_settings\"),\n  async (req: Request, res: Response) => {\n    try {\n      const { format = \"json\" } = req.query;\n\n      // This is a simplified export - in a real implementation you'd want to\n      // export actual data from multiple tables\n      const exportData = {\n        exported_at: new Date().toISOString(),\n        exported_by: req.user!.name,\n        version: \"1.0\",\n        data: {\n          settings: SystemSettingsRepository.findAll(),\n          // Add other data exports here\n        },\n      };\n\n      if (format === \"csv\") {\n        // Convert to CSV format\n        const csv = Object.entries(exportData.data.settings)\n          .map(([key, value]) => `${key},${value}`)\n          .join(\"\\n\");\n\n        res.setHeader(\"Content-Type\", \"text/csv\");\n        res.setHeader(\n          \"Content-Disposition\",\n          'attachment; filename=\"bd-ticketpro-export.csv\"',\n        );\n        res.send(`key,value\\n${csv}`);\n      } else {\n        res.setHeader(\"Content-Type\", \"application/json\");\n        res.setHeader(\n          \"Content-Disposition\",\n          'attachment; filename=\"bd-ticketpro-export.json\"',\n        );\n        res.json(exportData);\n      }\n\n      // Log activity\n      ActivityLogRepository.create({\n        user_id: req.user!.id,\n        action: \"export_data\",\n        entity_type: \"system\",\n        details: JSON.stringify({\n          format,\n          exported_by: req.user!.name,\n        }),\n        ip_address: req.ip || req.connection.remoteAddress,\n        user_agent: req.get(\"User-Agent\"),\n      });\n    } catch (error) {\n      console.error(\"Export data error:\", error);\n      res.status(500).json({\n        success: false,\n        message: \"Internal server error\",\n        error: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  },\n);\n\n// Get activity logs (admin only)\nrouter.get(\n  \"/logs/activity\",\n  requirePermission(\"system_settings\"),\n  async (req: Request, res: Response) => {\n    try {\n      const { limit = 100, user_id } = req.query;\n\n      let logs;\n      if (user_id) {\n        logs = ActivityLogRepository.findByUser(\n          user_id as string,\n          parseInt(limit as string),\n        );\n      } else {\n        logs = ActivityLogRepository.findRecent(parseInt(limit as string));\n      }\n\n      res.json({\n        success: true,\n        message: \"Activity logs retrieved successfully\",\n        data: {\n          logs,\n          total: logs.length,\n        },\n      });\n    } catch (error) {\n      console.error(\"Get activity logs error:\", error);\n      res.status(500).json({\n        success: false,\n        message: \"Internal server error\",\n        error: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  },\n);\n\n// Get system information (authenticated users)\nrouter.get(\"/system-info\", async (_req: Request, res: Response) => {\n  console.log(\"System info route called\");\n    try {\n      console.log(\"Building system info...\");\n\n      // Get system information\n      const systemInfo = {\n        version: \"1.0.0\",\n        uptime: formatUptime(os.uptime()),\n        memory_usage: formatBytes(process.memoryUsage().heapUsed),\n        cpu_usage: `${os.loadavg()[0].toFixed(2)}%`,\n        disk_usage: await getDiskUsage(),\n        active_sessions: 1, // You can implement session tracking\n        total_users: 3, // Get from database\n        total_bookings: 0, // Get from database\n        database_size: await getDatabaseSize(),\n        last_backup: getLastBackupTime(),\n      };\n\n      console.log(\"System info built successfully:\", systemInfo);\n\n      res.json({\n        success: true,\n        message: \"System information retrieved successfully\",\n        data: systemInfo,\n      });\n    } catch (error) {\n      console.error(\"Get system info error:\", error);\n      res.status(500).json({\n        success: false,\n        message: \"Internal server error\",\n        error: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  },\n);\n\n// Create backup (admin only)\nrouter.post(\"/backup\", requirePermission(\"system_settings\"), async (req: Request, res: Response) => {\n    try {\n      // Create backup directory if it doesn't exist\n      const backupDir = path.join(process.cwd(), \"backups\");\n      if (!fs.existsSync(backupDir)) {\n        fs.mkdirSync(backupDir, { recursive: true });\n      }\n\n      // Create backup filename with timestamp\n      const timestamp = new Date().toISOString().replace(/[:.]/g, \"-\");\n      const backupFile = path.join(backupDir, `backup-${timestamp}.db`);\n\n      // Copy the database file\n      const dbPath = path.join(process.cwd(), \"bd-ticketpro.db\");\n      if (fs.existsSync(dbPath)) {\n        fs.copyFileSync(dbPath, backupFile);\n\n        // Log activity\n        ActivityLogRepository.create({\n          user_id: req.user!.id,\n          action: \"create_backup\",\n          entity_type: \"system\",\n          entity_id: \"backup\",\n          details: `Database backup created: ${backupFile}`,\n          ip_address: req.ip,\n          user_agent: req.get(\"User-Agent\") || \"\",\n        });\n\n        res.json({\n          success: true,\n          message: \"Backup created successfully\",\n          data: {\n            backup_file: backupFile,\n            timestamp,\n            size: fs.statSync(backupFile).size,\n          },\n        });\n      } else {\n        res.status(404).json({\n          success: false,\n          message: \"Database file not found\",\n        });\n      }\n    } catch (error) {\n      console.error(\"Create backup error:\", error);\n      res.status(500).json({\n        success: false,\n        message: \"Failed to create backup\",\n        error: error instanceof Error ? error.message : 'Unknown error',\n      });\n    }\n  },\n);\n\n// Helper functions\nfunction formatUptime(uptime: number): string {\n  const days = Math.floor(uptime / 86400);\n  const hours = Math.floor((uptime % 86400) / 3600);\n  const minutes = Math.floor((uptime % 3600) / 60);\n  return `${days}d ${hours}h ${minutes}m`;\n}\n\nfunction formatBytes(bytes: number): string {\n  const sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\"];\n  if (bytes === 0) return \"0 Bytes\";\n  const i = Math.floor(Math.log(bytes) / Math.log(1024));\n  return Math.round((bytes / Math.pow(1024, i)) * 100) / 100 + \" \" + sizes[i];\n}\n\nasync function getDiskUsage(): Promise<string> {\n  try {\n    // Get available disk space (simplified approach)\n    // In a real production environment, you'd use a library like 'check-disk-space'\n    return \"Available\"; // Placeholder since getting disk space requires additional dependencies\n  } catch {\n    return \"Unknown\";\n  }\n}\n\nasync function getDatabaseSize(): Promise<string> {\n  try {\n    const dbPath = path.join(process.cwd(), \"bd-ticketpro.db\");\n    if (fs.existsSync(dbPath)) {\n      const stats = fs.statSync(dbPath);\n      return formatBytes(stats.size);\n    }\n    return \"Unknown\";\n  } catch {\n    return \"Unknown\";\n  }\n}\n\nfunction getLastBackupTime(): string {\n  try {\n    const backupDir = path.join(process.cwd(), \"backups\");\n\n    if (!fs.existsSync(backupDir)) {\n      return \"Never\";\n    }\n\n    const files = fs\n      .readdirSync(backupDir)\n      .filter(\n        (file: string) => file.startsWith(\"backup-\") && file.endsWith(\".db\"),\n      )\n      .map((file: string) => {\n        const filePath = path.join(backupDir, file);\n        return {\n          file,\n          time: fs.statSync(filePath).mtime,\n        };\n      })\n      .sort((a: any, b: any) => b.time - a.time);\n\n    if (files.length > 0) {\n      return files[0].time.toLocaleString();\n    }\n    return \"Never\";\n  } catch {\n    return \"Unknown\";\n  }\n}\n\nexport default router;\n","import express from \"express\";\nimport cors from \"cors\";\nimport { initializeDatabase, seedDatabase } from \"./database/schema\";\n\n// Import API routes\nimport authRoutes from \"./routes/auth\";\nimport ticketRoutes from \"./routes/tickets\";\nimport ticketBatchRoutes from \"./routes/ticket-batches\";\nimport bookingRoutes from \"./routes/bookings\";\nimport userRoutes from \"./routes/users\";\nimport settingsRoutes from \"./routes/settings\";\n\nexport function createServer() {\n  const app = express();\n\n  // Initialize database\n  try {\n    initializeDatabase();\n    seedDatabase();\n    console.log(\"Database initialized and seeded successfully\");\n  } catch (error) {\n    console.error(\"Database initialization error:\", error);\n  }\n\n  // Middleware\n  app.use(\n    cors({\n      origin:\n        process.env.NODE_ENV === \"production\"\n          ? [\"https://musafirdesk.com\", \"http://localhost:8080\", /\\.vercel\\.app$/] // Add Vercel domains\n          : [\"http://localhost:3000\", \"http://localhost:5173\"], // Development origins\n      credentials: true,\n    }),\n  );\n\n  app.use(express.json({ limit: \"10mb\" }));\n  app.use(express.urlencoded({ extended: true, limit: \"10mb\" }));\n\n  // Add request logging middleware (only in development)\n  if (process.env.NODE_ENV !== \"production\") {\n    app.use((_req, _res, next) => {\n      // Type assertion to fix TypeScript error\n      console.log(`${new Date().toISOString()} - ${(_req as any).method} ${(_req as any).path}`);\n      next();\n    });\n  }\n\n  // Health check endpoint\n  app.get(\"/api/ping\", (_req, res) => {\n    res.json({\n      message: \"BD TicketPro API Server\",\n      status: \"healthy\",\n      timestamp: new Date().toISOString(),\n      version: \"1.0.0\",\n    });\n  });\n\n  // API Routes\n  app.use(\"/api/auth\", authRoutes);\n  app.use(\"/api/tickets\", ticketRoutes);\n  app.use(\"/api/ticket-batches\", ticketBatchRoutes);\n  app.use(\"/api/bookings\", bookingRoutes);\n  app.use(\"/api/users\", userRoutes);\n  app.use(\"/api/settings\", settingsRoutes);\n\n  // Global error handler\n  app.use(\n    (\n      err: any,\n      _req: express.Request,\n      _res: express.Response,\n      _next: express.NextFunction,\n    ) => {\n      console.error(\"Global error handler:\", err);\n\n      _res.status(err.status || 500).json({\n        success: false,\n        message: err.message || \"Internal server error\",\n        ...(process.env.NODE_ENV === \"development\" && { stack: err.stack }),\n      });\n    },\n  );\n\n  // 404 handler for API routes\n  app.use(\"/api/*\", (req, res) => {\n    res.status(404).json({\n      success: false,\n      message: \"API endpoint not found\",\n      path: req.path,\n    });\n  });\n\n  return app;\n}","import path from \"path\";\nimport { createServer } from \"./index\";\nimport * as express from \"express\";\n\nconst app = createServer();\nconst port = process.env.PORT || 3000;\n\n// In production, serve the built SPA files\nconst __dirname = import.meta.dirname;\nconst distPath = path.join(__dirname, \"../spa\");\n\n// Serve static files\napp.use(express.static(distPath));\n\n// Handle React Router - serve index.html for all non-API routes\napp.get(\"*\", (req, res) => {\n  // Don't serve index.html for API routes\n  if (req.path.startsWith(\"/api/\") || req.path.startsWith(\"/health\")) {\n    return res.status(404).json({ error: \"API endpoint not found\" });\n  }\n\n  res.sendFile(path.join(distPath, \"index.html\"));\n});\n\napp.listen(port, () => {\n  console.log(`ðŸš€ Fusion Starter server running on port ${port}`);\n  console.log(`ðŸ“± Frontend: http://localhost:${port}`);\n  console.log(`ðŸ”§ API: http://localhost:${port}/api`);\n});\n\n// Graceful shutdown\nprocess.on(\"SIGTERM\", () => {\n  console.log(\"ðŸ›‘ Received SIGTERM, shutting down gracefully\");\n  process.exit(0);\n});\n\nprocess.on(\"SIGINT\", () => {\n  console.log(\"ðŸ›‘ Received SIGINT, shutting down gracefully\");\n  process.exit(0);\n});\n"],"names":["uuidv4","router","bcrypt","dbPath","app","express","authRoutes","ticketRoutes","ticketBatchRoutes","bookingRoutes","userRoutes","settingsRoutes","path"],"mappings":"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"}